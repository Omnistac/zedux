"use strict";(self.webpackChunkzedux_docs=self.webpackChunkzedux_docs||[]).push([[5565],{3960:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   "assets": function() { return /* binding */ assets; },\n/* harmony export */   "contentTitle": function() { return /* binding */ contentTitle; },\n/* harmony export */   "default": function() { return /* binding */ MDXContent; },\n/* harmony export */   "frontMatter": function() { return /* binding */ frontMatter; },\n/* harmony export */   "metadata": function() { return /* binding */ metadata; },\n/* harmony export */   "toc": function() { return /* binding */ toc; }\n/* harmony export */ });\n/* harmony import */ var _Users_joshuaclaunch_code_oss_zedux_docs_node_modules_babel_runtime_helpers_esm_extends_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(7462);\n/* harmony import */ var _Users_joshuaclaunch_code_oss_zedux_docs_node_modules_babel_runtime_helpers_esm_objectWithoutPropertiesLoose_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(3366);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(7294);\n/* harmony import */ var _mdx_js_react__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(3905);\nvar _excluded=["components"];/* @jsxRuntime classic */ /* @jsx mdx */ /* @jsxFrag React.Fragment */var frontMatter={id:\'time-travel\',title:\'Time Travel\'};var contentTitle=undefined;var metadata={"unversionedId":"advanced/time-travel","id":"advanced/time-travel","title":"Time Travel","description":"This guide is very low-level. Dev tools should implement this for you.","source":"@site/docs/advanced/time-travel.mdx","sourceDirName":"advanced","slug":"/advanced/time-travel","permalink":"/zedux/docs/advanced/time-travel","draft":false,"editUrl":"https://github.com/Omnistac/zedux/tree/master/docs/advanced/time-travel.mdx","tags":[],"version":"current","frontMatter":{"id":"time-travel","title":"Time Travel"},"sidebar":"react","previous":{"title":"Store Composition","permalink":"/zedux/docs/advanced/store-composition"},"next":{"title":"TypeScript Tips","permalink":"/zedux/docs/advanced/typescript-tips"}};var assets={};var toc=[{value:\'Time Travel Basics\',id:\'time-travel-basics\',level:2},{value:\'In Zedux\',id:\'in-zedux\',level:2},{value:\'Store Traveler\',id:\'store-traveler\',level:2},{value:\'Atom Traveler\',id:\'atom-traveler\',level:2},{value:\'Ecosystem Traveler\',id:\'ecosystem-traveler\',level:2},{value:\'Recap\',id:\'recap\',level:2}];var layoutProps={toc:toc};var MDXLayout="wrapper";function MDXContent(_ref){var components=_ref.components,props=(0,_Users_joshuaclaunch_code_oss_zedux_docs_node_modules_babel_runtime_helpers_esm_objectWithoutPropertiesLoose_js__WEBPACK_IMPORTED_MODULE_2__/* ["default"] */ .Z)(_ref,_excluded);return (0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)(MDXLayout,(0,_Users_joshuaclaunch_code_oss_zedux_docs_node_modules_babel_runtime_helpers_esm_extends_js__WEBPACK_IMPORTED_MODULE_3__/* ["default"] */ .Z)({},layoutProps,props,{components:components,mdxType:"MDXLayout"}),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("admonition",{"title":"low-level warning","type":"caution"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",{parentName:"admonition"},"This guide is very low-level. Dev tools should implement this for you."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",{parentName:"admonition"},"If you\'re new here, you probably don\'t want to read this doc yet.")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("admonition",{"type":"tip"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",{parentName:"admonition"},"This guide assumes knowledge of the ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("a",{parentName:"p","href":"store-composition"},"store composition guide"),". It\'s recommended to read that first.")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Redux popularized the ability to undo and redo state updates in your app. Earlier flux models didn\'t have this capability because they split state up across multiple stores. Well Zedux reintroduces the concept of multiple stores, so does that mean it loses out on time travel?"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Zedux also introduces the concept of zero-config stores. In Redux, the boilerplate-heavy action-reducer model is central to its time traveling ability. Surely zero-config Zedux stores can\'t time travel... Can they?"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"As you can probably guess by the existence of this walkthrough page, the answer is that Zedux fully supports time travel. Let\'s Learn Everything."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("admonition",{"title":"you will learn:","type":"tip"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("ul",{parentName:"admonition"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"How Zedux\'s powerful store composition model enables time travel."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"How to implement undo/redo for individual stores, atoms, or an entire ecosystem."))),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("h2",{"id":"time-travel-basics"},"Time Travel Basics"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"First off, time travel has several overlapping concepts, with differing opinions about what they mean. This guide will assume these meanings:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("ul",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Undo/Redo - Step backward and forward through a state history."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Replayable Actions - Given a list of actions and a starting state, dispatch those actions one-by-one to consistently arrive at a final state."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Time Travel - The overarching concept containing both undo/redo and replayable actions, adding the ability to jump backward several states at a time or forward several states or actions at a time.")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Undo/redo is cool, but more limited, since it doesn\'t dispatch actions exactly how they were originally dispatched. This means undo/redo can skip side effects or run them in an entirely different way than the real app. However, if you manage to design your side effects around this (nigh impossible), it can be very powerful."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Replayable actions more faithfully replicate state changes. In Zedux, all state changes produce an action that can be used to fully reproduce the state change."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Zedux has full support for both kinds of time travel at the store, atom instance, and ecosystem levels. This guide will demonstrate undo/redo since it\'s generally simpler, but the high-level concepts should also give enough insight into how to implement replayable actions."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("h2",{"id":"in-zedux"},"In Zedux"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Every state update in Zedux is trackable and reproducible. When tracking changes in a composed store hierarchy, you only need one subscriber in the root store."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Every parent store is able to track and reproduce every state change anywhere in its children, grandchildren, etc. That means a subscriber attached to the parent store receives actions that can be used to reproduce every state change (useful for replayable actions). Also, setting state on the parent store directly updates its children (useful for undo/redo)."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts","metastring":"live resultVar=output","live":true,"resultVar":"output"},"const parent = createStore()\\nconst child = createStore()\\n\\nparent.use({ child })\\n\\nchild.setState(\'initial state\')\\nparent.setState({ child: \'better state\' })\\n\\nconst output = {\\n  child: child.getState(),\\n  parent: parent.getState(),\\n}\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"To track and replay an action:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts","metastring":"live resultVar=output","live":true,"resultVar":"output"},"const parent = createStore()\\nconst child = createStore()\\n\\nparent.use({ child })\\n\\n// for this example, we\'ll track one action and re-dispatch it:\\nlet trackedAction\\n\\nparent.subscribe({\\n  effects: ({ action }) => {\\n    if (!trackedAction) trackedAction = action\\n  },\\n})\\n\\n// creates a \\"pseudo-action\\"\\nchild.setState(\'initial state\') // we\'ll track this state ...\\nchild.setState(\'better state\') // ... and use it to override this state\\n\\n// dispatch the tracked action directly to the parent store:\\nparent.dispatch(trackedAction)\\n\\nconst output = {\\n  child: child.getState(),\\n  parent: parent.getState(),\\n  trackedAction,\\n}\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Bottom line: In Zedux, you only need access to the parent store and you\'re golden. Atoms naturally expose exactly one parent store, so this works out beautifully."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"The rest of this guide will walk through specific possible implementations of undo/redo. You should probably not be implementing time travel yourself, but if you\'re curious, by all means continue."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("h2",{"id":"store-traveler"},"Store Traveler"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"To implement undo/redo for a store, first attach a subscriber to the parent store:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const formStore = createStore()\\nconst emailStore = createStore(null, \'\')\\nconst passwordStore = createStore(null, \'\')\\n\\nformStore.use({\\n  email: emailStore,\\n  password: passwordStore,\\n})\\n\\nformStore.subscribe((newState, oldState) => {\\n  if (newState === oldState) return\\n\\n  // we\'ll add this logic next\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("admonition",{"type":"tip"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",{parentName:"admonition"},"To implement replayable actions, you\'d need to attach an effects subscriber instead to receive a notification for every action.")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Now the parent needs to track state history somewhere. We\'ll use another store for this."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"// highlight-start\\nconst historyStore = createStore(null, {\\n  history: [formStore.getState()], // start with the current state\\n})\\n// highlight-end\\n\\nformStore.subscribe((newState, oldState) => {\\n  if (newState === oldState) return\\n\\n  // highlight-start\\n  historyStore.setState(({ history }) => ({\\n    history: [...history, newState],\\n  }))\\n  // highlight-end\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"With history tracked, we need the ability to \\"point\\" to a different state in the history. This lets us keep track of where we\'ve time traveled to. Default this to pointing at the last history state."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const historyStore = createStore(null, {\\n  history: [formStore.getState()],\\n  // highlight-next-line\\n  pointer: 0,\\n})\\n\\nformStore.subscribe((newState, oldState) => {\\n  if (newState === oldState) return\\n\\n  historyStore.setState(({ history, pointer }) => ({\\n    history: [...history, newState],\\n    // highlight-next-line\\n    pointer: pointer + 1,\\n  }))\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Now to implement undo/redo:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const undo = () => {\\n  const newState = historyStore.setStateDeep(({ pointer }) => ({\\n    pointer: Math.max(0, pointer - 1),\\n  }))\\n\\n  formStore.setState(newState.history[newState.pointer])\\n}\\n\\nconst redo = () => {\\n  const newState = historyStore.setStateDeep(({ history, pointer }) => ({\\n    pointer: Math.min(history.length - 1, pointer + 1),\\n  }))\\n\\n  formStore.setState(newState.history[newState.pointer])\\n}\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"We use ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"Math.min")," and ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"Math.max")," to clamp the pointer to the history length."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"But now there\'s a problem. Setting the ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"formStore"),"s state like this will trigger the subscriber, pushing the state onto the history again! When we call ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"undo"),"/",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"redo"),", we need to prevent the subscriber from running."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"There are several ways to accomplish that. We\'ll do this:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"formStore.subscribe((newState, oldState) => {\\n  if (newState === oldState) return\\n\\n  // highlight-start\\n  const { history, pointer } = historyStore.getState()\\n  if (newState === history[pointer]) return\\n  // highlight-end\\n\\n  historyStore.setState(({ history, pointer }) => ({\\n    history: [...history, newState],\\n    pointer: pointer + 1,\\n  }))\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"If the current state exactly matches the state the history is pointing at, we know the current state is a history state. We don\'t need to track it."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Almost there! We just need to fix one little thing. If the user changes the form\'s state while we\'re showing a history state, we need to erase the history after the pointer and start tracking history anew starting from the pointer\'s location."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"formStore.subscribe((newState, oldState) => {\\n  if (newState === oldState) return\\n\\n  const { history, pointer } = historyStore.getState()\\n  if (newState === history[pointer]) return\\n\\n  historyStore.setState(({ history, pointer }) => ({\\n    // highlight-next-line\\n    history: [...history.slice(0, pointer + 1), newState],\\n    pointer: pointer + 1,\\n  }))\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Alright! We\'re ready to put it all together. Here\'s the full example wrapped in a simple ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"form")," atom:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-tsx","metastring":"live ecosystemId=time-travel/store-traveler resultVar=App","live":true,"ecosystemId":"time-travel/store-traveler","resultVar":"App"},"const formAtom = atom(\'form\', () => {\\n  const formStore = injectStore()\\n  const emailStore = injectStore(\'\', { subscribe: false }) // don\'t need to subscribe to child stores\\n  const passwordStore = injectStore(\'\', { subscribe: false }) // don\'t need to subscribe to child stores\\n\\n  formStore.use({\\n    email: emailStore,\\n    password: passwordStore,\\n  })\\n\\n  const historyStore = injectStore({\\n    history: [formStore.getState()],\\n    pointer: 0,\\n  })\\n\\n  injectEffect(() => {\\n    const subscription = formStore.subscribe((newState, oldState) => {\\n      if (newState === oldState) return\\n\\n      const { history, pointer } = historyStore.getState()\\n      if (newState === history[pointer]) return\\n\\n      historyStore.setState(({ history, pointer }) => ({\\n        history: [...history.slice(0, pointer + 1), newState],\\n        pointer: pointer + 1,\\n      }))\\n    })\\n\\n    return () => subscription.unsubscribe()\\n  }, [])\\n\\n  const redo = () => {\\n    const newState = historyStore.setStateDeep(({ history, pointer }) => ({\\n      pointer: Math.min(history.length - 1, pointer + 1),\\n    }))\\n\\n    formStore.setState(newState.history[newState.pointer])\\n  }\\n\\n  const setEmail = email => emailStore.setState(email)\\n  const setPassword = password => passwordStore.setState(password)\\n\\n  const undo = () => {\\n    const newState = historyStore.setStateDeep(({ pointer }) => ({\\n      pointer: Math.max(0, pointer - 1),\\n    }))\\n\\n    formStore.setState(newState.history[newState.pointer])\\n  }\\n\\n  return api(formStore).setExports({\\n    redo,\\n    setEmail,\\n    setPassword,\\n    undo,\\n  })\\n})\\n\\nfunction Devtools() {\\n  const { redo, undo } = useAtomInstance(formAtom).exports\\n\\n  return (\\n    <div>\\n      <button onClick={undo}>Undo</button>\\n      <button onClick={redo}>Redo</button>\\n    </div>\\n  )\\n}\\n\\nfunction LoginForm() {\\n  const [{ email, password }, { setEmail, setPassword }] = useAtomState(\\n    formAtom\\n  )\\n\\n  return (\\n    <>\\n      <div>\\n        Email:{\' \'}\\n        <input onChange={event => setEmail(event.target.value)} value={email} />\\n      </div>\\n      <div>\\n        Password:{\' \'}\\n        <input\\n          onChange={event => setPassword(event.target.value)}\\n          value={password}\\n        />\\n      </div>\\n    </>\\n  )\\n}\\n\\nfunction App() {\\n  return (\\n    <>\\n      <Devtools />\\n      <LoginForm />\\n    </>\\n  )\\n}\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("h2",{"id":"atom-traveler"},"Atom Traveler"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Since an atom has exactly one exposed store, undo/redo is very similar with atoms. In fact, you can simply extract the above time travel logic to a custom injector and reuse that in every atom where you want time travel. For example:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const injectTimeTravel = store => {\\n  const historyStore = injectStore({\\n    history: [formStore.getState()],\\n    pointer: 0,\\n  })\\n\\n  injectEffect(() => {\\n    const subscription = formStore.subscribe((newState, oldState) => {\\n      if (newState === oldState) return\\n\\n      const { history, pointer } = historyStore.getState()\\n      if (newState === history[pointer]) return\\n\\n      historyStore.setState(({ history, pointer }) => ({\\n        history: [...history.slice(0, pointer + 1), newState],\\n        pointer: pointer + 1,\\n      }))\\n    })\\n\\n    return () => subscription.unsubscribe()\\n  }, [])\\n\\n  const redo = () => {\\n    const newState = historyStore.setStateDeep(({ history, pointer }) => ({\\n      pointer: Math.min(history.length - 1, pointer + 1),\\n    }))\\n\\n    store.setState(newState.history[newState.pointer])\\n  }\\n\\n  const undo = () => {\\n    const newState = historyStore.setStateDeep(({ pointer }) => ({\\n      pointer: Math.max(0, pointer - 1),\\n    }))\\n\\n    store.setState(newState.history[newState.pointer])\\n  }\\n\\n  return api(historyStore).setExports({ redo, undo })\\n}\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Example usage:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const formAtom = atom(\'form\', () => {\\n  const formStore = injectStore()\\n  const emailStore = injectStore(\'\', { subscribe: false })\\n  const passwordStore = injectStore(\'\', { subscribe: false })\\n\\n  formStore.use({\\n    email: emailStore,\\n    password: passwordStore,\\n  })\\n\\n  // highlight-next-line\\n  const historyApi = injectTimeTravel(formStore)\\n\\n  const setEmail = email => emailStore.setState(email)\\n  const setPassword = password => passwordStore.setState(password)\\n\\n  return api(formStore).setExports({\\n    // highlight-next-line\\n    ...historyApi.exports,\\n    setEmail,\\n    setPassword,\\n  })\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"This approach is fine if it works for you, but a theoretical downside is that state management and time travel are orthogonal concerns. Tightly coupling an atom to its time travel implementation is ... weird. It should feel unnatural because it is."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Since we know we\'re working with an atom, we can upgrade this setup a little."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Remember that atoms can take other atom instances as params. We can use this power to create a ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"timeTravelAtom")," that accepts any atom instance and tacks time travel onto it."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const timeTravelAtom = ion(\'timeTravel\', ({ get }, instance) => {\\n  const instanceState = get(instance)\\n  const store = injectStore({\\n    history: [instanceState],\\n    pointer: 0,\\n  })\\n  const { history, pointer } = store.getState()\\n\\n  // if the state changed, add it to the history\\n  if (instanceState !== history[pointer]) {\\n    store.setStateDeep(({ history, pointer }) => ({\\n      history: [...history.slice(0, pointer + 1), instanceState],\\n      pointer: pointer + 1,\\n    }))\\n  }\\n\\n  const redo = () => {\\n    const newState = store.setStateDeep(({ history, pointer }) => ({\\n      pointer: Math.min(history.length - 1, pointer + 1),\\n    }))\\n\\n    instance.setState(newState.history[newState.pointer])\\n  }\\n\\n  const undo = () => {\\n    const newState = store.setStateDeep(({ pointer }) => ({\\n      pointer: Math.max(0, pointer - 1),\\n    }))\\n\\n    instance.setState(newState.history[newState.pointer])\\n  }\\n\\n  return api(store).setExports({ redo, undo })\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Example usage:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-tsx"},"function Devtools() {\\n  const instance = useAtomInstance(formAtom)\\n  const [stateHistory, { redo, undo }] = useAtomState(timeTravelAtom, [\\n    instance,\\n  ])\\n\\n  return (\\n    <div>\\n      <button onClick={undo}>Undo</button>\\n      <button onClick={redo}>Redo</button>\\n    </div>\\n  )\\n}\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"The primary advantage of this approach over the custom injector approach is that time travel is now a completely separate concern. Any atom can be made time-travelable, and no atom has to know whether it is."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Full live example:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-tsx","metastring":"live ecosystemId=time-travel/atom-traveler resultVar=App","live":true,"ecosystemId":"time-travel/atom-traveler","resultVar":"App"},"const textAtom = atom(\'text\', (id: string) => \'\')\\n\\nconst formAtom = atom(\'form\', () => {\\n  const store = injectStore()\\n  const emailInstance = injectAtomInstance(textAtom, [\'email\'])\\n  const passwordInstance = injectAtomInstance(textAtom, [\'password\'])\\n\\n  store.use({\\n    email: emailInstance.store,\\n    password: passwordInstance.store,\\n  })\\n\\n  return api(store).setExports({\\n    setEmail: email => store.setStateDeep({ email }),\\n    setPassword: password => store.setStateDeep({ password }),\\n  })\\n})\\n\\nconst timeTravelAtom = ion(\'timeTravel\', ({ get }, instance) => {\\n  const instanceState = get(instance)\\n  const store = injectStore({\\n    history: [instanceState],\\n    pointer: 0,\\n  })\\n  const { history, pointer } = store.getState()\\n\\n  // if the state changed, add it to the history\\n  if (instanceState !== history[pointer]) {\\n    store.setStateDeep(({ history, pointer }) => ({\\n      history: [...history.slice(0, pointer + 1), instanceState],\\n      pointer: pointer + 1,\\n    }))\\n  }\\n\\n  const redo = () => {\\n    const newState = store.setStateDeep(({ history, pointer }) => ({\\n      pointer: Math.min(history.length - 1, pointer + 1),\\n    }))\\n\\n    instance.setState(newState.history[newState.pointer])\\n  }\\n\\n  const undo = () => {\\n    const newState = store.setStateDeep(({ pointer }) => ({\\n      pointer: Math.max(0, pointer - 1),\\n    }))\\n\\n    instance.setState(newState.history[newState.pointer])\\n  }\\n\\n  return api(store).setExports({ redo, undo })\\n})\\n\\nfunction Devtools() {\\n  const instance = useAtomInstance(formAtom)\\n  const { redo, undo } = useAtomInstance(timeTravelAtom, [instance]).exports\\n\\n  return (\\n    <div>\\n      <button onClick={undo}>Undo</button>\\n      <button onClick={redo}>Redo</button>\\n    </div>\\n  )\\n}\\n\\nfunction LoginForm() {\\n  const [{ email, password }, { setEmail, setPassword }] = useAtomState(\\n    formAtom\\n  )\\n\\n  return (\\n    <>\\n      <div>\\n        Email:{\' \'}\\n        <input onChange={event => setEmail(event.target.value)} value={email} />\\n      </div>\\n      <div>\\n        Password:{\' \'}\\n        <input\\n          onChange={event => setPassword(event.target.value)}\\n          value={password}\\n        />\\n      </div>\\n    </>\\n  )\\n}\\n\\nfunction App() {\\n  return (\\n    <>\\n      <Devtools />\\n      <LoginForm />\\n    </>\\n  )\\n}\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("h2",{"id":"ecosystem-traveler"},"Ecosystem Traveler"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("admonition",{"type":"tip"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",{parentName:"admonition"},"This section assumes basic knowledge of ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("a",{parentName:"p","href":"plugins"},"plugins"),". It\'s recommended to read that guide first.")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Alright, we\'re in a completely different world now. Tracking and restoring every state change in the entire application is a big task and can only be accomplished with plugins."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"To track state changes, a plugin needs to turn on the ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("a",{parentName:"p","href":"../api/classes/ZeduxPlugin#statechanged"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"a"},"stateChanged")," mod"),"."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"import { ZeduxPlugin } from \'@zedux/react\'\\n\\nconst timeTravelPlugin = new ZeduxPlugin({\\n  initialMods: [\'stateChanged\'],\\n\\n  registerEcosystem: ecosystem => {\\n    // we\'ll add this logic next\\n  },\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Now you need to track history state. This is almost the same as tracking history state for a single atom, but with a separate entry for every atom."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"A simple way to get an object mapping atom instance ids to their values is to use ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("a",{parentName:"p","href":"../api/classes/Ecosystem#dehydrate"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"a"},"ecosystem.dehydrate()")),":"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const timeTravelPlugin = new ZeduxPlugin({\\n  initialMods: [\'stateChanged\'],\\n\\n  registerEcosystem: ecosystem => {\\n    // highlight-start\\n    const state = {\\n      history: [ecosystem.dehydrate({ excludeFlags: [\'no-time-travel\'] })],\\n      pointer: 0,\\n    }\\n    // highlight-end\\n  },\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Now add a simple subscription on the ecosystem\'s ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("a",{parentName:"p","href":"../api/classes/Ecosystem#modbus"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"a"},"modBus"))," that filters out everything but ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"stateChanged")," mod events."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Since atom selectors also trigger ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"stateChanged")," mod events, filter out any events that don\'t have a ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},".instance")," property too. Time travel only deals with top-level state. State derivations like selectors shouldn\'t be tracked."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const timeTravelPlugin = new ZeduxPlugin({\\n  initialMods: [\'stateChanged\'],\\n\\n  registerEcosystem: ecosystem => {\\n    const state = {\\n      history: [ecosystem.dehydrate({ excludeFlags: [\'no-time-travel\'] })],\\n      pointer: 0,\\n    }\\n\\n    // highlight-start\\n    const subscription = ecosystem.modBus.subscribe({\\n      effects: ({ action }) => {\\n        // only handle stateChanged mod events for atom instances\\n        if (\\n          action.type === ZeduxPlugin.actions.stateChanged.type &&\\n          action.payload?.instance\\n        ) {\\n          state.history = [\\n            ...state.history.slice(0, state.pointer + 1),\\n            ecosystem.dehydrate({ excludeFlags: [\'no-time-travel\'] }),\\n          ]\\n          state.pointer += 1\\n        }\\n      },\\n    })\\n    // highlight-end\\n\\n    return () => subscription.unsubscribe()\\n  },\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"Now we need to actually handle undo/redo. We\'ll use the ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("a",{parentName:"p","href":"plugins#via-modbus"},(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"a"},"modBus")," to send actions")," to the plugin. The plugin can use its existing ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"modBus")," subscription to listen for ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"undo")," and ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"redo")," events:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"// highlight-start\\nconst undo = actionFactory(\'@@timeTravel/undo\')\\nconst redo = actionFactory(\'@@timeTravel/redo\')\\n// highlight-end\\n\\nconst timeTravelPlugin = new ZeduxPlugin({\\n  initialMods: [\'stateChanged\'],\\n\\n  registerEcosystem: ecosystem => {\\n    const state = {\\n      history: [ecosystem.dehydrate({ excludeFlags: [\'no-time-travel\'] })],\\n      // highlight-next-line\\n      isHydrating: false,\\n      pointer: 0,\\n    }\\n\\n    const subscription = ecosystem.modBus.subscribe({\\n      effects: ({ action }) => {\\n        // only track history if we\'re not currently time traveling\\n        // highlight-next-line\\n        if (state.isHydrating) return\\n\\n        // only handle stateChanged mod events for atom instances\\n        if (\\n          action.type === ZeduxPlugin.actions.stateChanged.type &&\\n          action.payload?.instance\\n        ) {\\n          state.history = [\\n            ...state.history.slice(0, state.pointer + 1),\\n            ecosystem.dehydrate({ excludeFlags: [\'no-time-travel\'] }),\\n          ]\\n          state.pointer += 1\\n          return\\n        }\\n\\n        // highlight-start\\n        if (action.type === undo.type) {\\n          const { pointer } = state\\n          const newPointer = Math.max(0, pointer - 1)\\n\\n          if (newPointer === pointer) return\\n\\n          state.pointer = newPointer\\n          state.isHydrating = true\\n          ecosystem.hydrate(state.history[newPointer])\\n          state.isHydrating = false\\n          return\\n        }\\n\\n        if (action.type === redo.type) {\\n          const { history, pointer } = state\\n          const newPointer = Math.min(history.length - 1, pointer + 1)\\n\\n          if (newPointer === pointer) return\\n\\n          state.pointer = newPointer\\n          state.isHydrating = true\\n          ecosystem.hydrate(state.history[newPointer])\\n          state.isHydrating = false\\n          return\\n        }\\n        // highlight-end\\n      },\\n    })\\n\\n    return () => subscription.unsubscribe()\\n  },\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"There\'s one last thing to fix. Since ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"registerEcosystem")," is called as soon as the plugin is registered, our initial state snapshot will be empty. The ecosystem doesn\'t know what atoms are going to exist inside it, so the dehydration is a completely empty object."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"This means that the hydration won\'t affect any atoms. There are several ways to fix this."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"One approach is to make the plugin hook into ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"statusChanged")," events and walk back through the state history, updating every snapshot to include the new atom\'s initial state when a new atom\'s ",(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("inlineCode",{parentName:"p"},"status")," changes from Initializing to Active."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"But for simplicity in this example, we\'re just gonna set the initial history the first time we see any state change, instead of setting it as soon as the plugin is registered in the ecosystem."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-ts"},"const timeTravelPlugin = new ZeduxPlugin({\\n  initialMods: [\'stateChanged\'],\\n\\n  registerEcosystem: ecosystem => {\\n    const state = {\\n      // highlight-next-line\\n      history: [],\\n      isHydrating: false,\\n      pointer: 0,\\n    }\\n\\n    const subscription = ecosystem.modBus.subscribe({\\n      effects: ({ action }) => {\\n        // only track history if we\'re not currently time traveling\\n        if (state.isHydrating) return\\n\\n        // only handle stateChanged mod events for atom instances\\n        if (\\n          action.type === ZeduxPlugin.actions.stateChanged.type &&\\n          action.payload?.instance\\n        ) {\\n          // get initial snapshot now\\n          // highlight-start\\n          if (!state.history.length) {\\n            const snapshot = ecosystem.dehydrate({\\n              excludeFlags: [\'no-time-travel\'],\\n            })\\n\\n            snapshot[action.payload.instance.id] = action.payload.oldState\\n            state.history.push(snapshot)\\n          }\\n          // highlight-end\\n\\n          state.history = [\\n            ...state.history.slice(0, state.pointer + 1),\\n            ecosystem.dehydrate({ excludeFlags: [\'no-time-travel\'] }),\\n          ]\\n          state.pointer += 1\\n          return\\n        }\\n\\n        if (action.type === undo.type) {\\n          const { pointer } = state\\n          const newPointer = Math.max(0, pointer - 1)\\n\\n          if (newPointer === pointer) return\\n\\n          state.pointer = newPointer\\n          state.isHydrating = true\\n          ecosystem.hydrate(state.history[newPointer])\\n          state.isHydrating = false\\n          return\\n        }\\n\\n        if (action.type === redo.type) {\\n          const { history, pointer } = state\\n          const newPointer = Math.min(history.length - 1, pointer + 1)\\n\\n          if (newPointer === pointer) return\\n\\n          state.pointer = newPointer\\n          state.isHydrating = true\\n          ecosystem.hydrate(state.history[newPointer])\\n          state.isHydrating = false\\n          return\\n        }\\n      },\\n    })\\n\\n    return () => subscription.unsubscribe()\\n  },\\n})\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("p",null,"And finally, all together:"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("pre",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("code",{parentName:"pre","className":"language-tsx","metastring":"live ecosystemId=ecosystem-time-travel noProvide resultVar=App","live":true,"ecosystemId":"ecosystem-time-travel","noProvide":true,"resultVar":"App"},"const undo = actionFactory(\'@@timeTravel/undo\')\\nconst redo = actionFactory(\'@@timeTravel/redo\')\\n\\nconst timeTravelPlugin = new ZeduxPlugin({\\n  initialMods: [\'stateChanged\'],\\n\\n  registerEcosystem: ecosystem => {\\n    const state = {\\n      history: [],\\n      isHydrating: false,\\n      pointer: 0,\\n    }\\n\\n    const subscription = ecosystem.modBus.subscribe({\\n      effects: ({ action }) => {\\n        // only track history if we\'re not currently time traveling\\n        if (state.isHydrating) return\\n\\n        // only handle stateChanged mod events for atom instances\\n        if (\\n          action.type === ZeduxPlugin.actions.stateChanged.type &&\\n          action.payload?.instance\\n        ) {\\n          // get initial snapshot now\\n          if (!state.history.length) {\\n            const snapshot = ecosystem.dehydrate({\\n              excludeFlags: [\'no-time-travel\'],\\n            })\\n\\n            snapshot[action.payload.instance.id] = action.payload.oldState\\n            state.history.push(snapshot)\\n          }\\n\\n          state.history = [\\n            ...state.history.slice(0, state.pointer + 1),\\n            ecosystem.dehydrate({ excludeFlags: [\'no-time-travel\'] }),\\n          ]\\n          state.pointer += 1\\n          return\\n        }\\n\\n        if (action.type === undo.type) {\\n          const { pointer } = state\\n          const newPointer = Math.max(0, pointer - 1)\\n\\n          if (newPointer === pointer) return\\n\\n          state.pointer = newPointer\\n          state.isHydrating = true\\n          ecosystem.hydrate(state.history[newPointer])\\n          state.isHydrating = false\\n          return\\n        }\\n\\n        if (action.type === redo.type) {\\n          const { history, pointer } = state\\n          const newPointer = Math.min(history.length - 1, pointer + 1)\\n\\n          if (newPointer === pointer) return\\n\\n          state.pointer = newPointer\\n          state.isHydrating = true\\n          ecosystem.hydrate(state.history[newPointer])\\n          state.isHydrating = false\\n          return\\n        }\\n      },\\n    })\\n\\n    return () => subscription.unsubscribe()\\n  },\\n})\\n\\nconst formAtom = atom(\'form\', () => {\\n  const store = injectStore({\\n    email: \'\',\\n    password: \'\',\\n  })\\n\\n  return api(store).setExports({\\n    setEmail: email => store.setStateDeep({ email }),\\n    setPassword: password => store.setStateDeep({ password }),\\n  })\\n})\\n\\nfunction Devtools() {\\n  const ecosystem = useEcosystem()\\n\\n  return (\\n    <div>\\n      <button onClick={() => ecosystem.modBus.dispatch(undo())}>Undo</button>\\n      <button onClick={() => ecosystem.modBus.dispatch(redo())}>Redo</button>\\n    </div>\\n  )\\n}\\n\\nfunction LoginForm() {\\n  const [{ email, password }, { setEmail, setPassword }] = useAtomState(\\n    formAtom\\n  )\\n\\n  return (\\n    <>\\n      <div>\\n        Email:{\' \'}\\n        <input onChange={event => setEmail(event.target.value)} value={email} />\\n      </div>\\n      <div>\\n        Password:{\' \'}\\n        <input\\n          onChange={event => setPassword(event.target.value)}\\n          value={password}\\n        />\\n      </div>\\n    </>\\n  )\\n}\\n\\nfunction App() {\\n  const ecosystem = useMemo(() => {\\n    const ecosystem = createEcosystem({ id: \'ecosystem-time-travel\' })\\n\\n    ecosystem.registerPlugin(timeTravelPlugin)\\n\\n    return ecosystem\\n  }, [])\\n\\n  return (\\n    <EcosystemProvider ecosystem={ecosystem}>\\n      <Devtools />\\n      <LoginForm />\\n    </EcosystemProvider>\\n  )\\n}\\n")),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("h2",{"id":"recap"},"Recap"),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("ul",null,(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"The parent store is a powerful single point of entry for working time travel magic."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Use a simple subscriber to track store state history (for undo/redo)."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Use an effects subscriber or action stream to track all actions dispatched to a store (for replayable actions)."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Dispatch tracked actions directly to the parent store to replay the action, no matter where in the hierarchy it originally happened."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Set state directly on the parent store to update the state of all or several child stores at once."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Passing atom instances as params is a powerful way to attach time travel to any atom instance while maintaining separation of concerns."),(0,_mdx_js_react__WEBPACK_IMPORTED_MODULE_1__/* .mdx */ .kt)("li",{parentName:"ul"},"Use a plugin for maximum control.")));};MDXContent.isMDXComponent=true;//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiMzk2MC5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OzZCQUVBLDBCQUNBLGVBQ0EsNkJBTU8sR0FBTUUsWUFBVyxDQUFHLENBQzFCQyxFQUFFLENBQUUsYUFBYSxDQUNqQkMsS0FBSyxDQUFFLGFBQ1IsQ0FBQyxDQUNNLEdBQU1DLGFBQVksQ0FBR0MsU0FBUyxDQUM5QixHQUFNQyxTQUFRLENBQUcsQ0FDdEIsZUFBZSxDQUFFLHNCQUFzQixDQUN2QyxJQUFJLENBQUUsc0JBQXNCLENBQzVCLE9BQU8sQ0FBRSxhQUFhLENBQ3RCLGFBQWEsQ0FBRSx3RUFBd0UsQ0FDdkYsUUFBUSxDQUFFLHFDQUFxQyxDQUMvQyxlQUFlLENBQUUsVUFBVSxDQUMzQixNQUFNLENBQUUsdUJBQXVCLENBQy9CLFdBQVcsQ0FBRSxrQ0FBa0MsQ0FDL0MsT0FBTyxDQUFFLEtBQUssQ0FDZCxTQUFTLENBQUUsNkVBQTZFLENBQ3hGLE1BQU0sQ0FBRSxFQUFFLENBQ1YsU0FBUyxDQUFFLFNBQVMsQ0FDcEIsYUFBYSxDQUFFLENBQ2IsSUFBSSxDQUFFLGFBQWEsQ0FDbkIsT0FBTyxDQUFFLGFBQ1gsQ0FBQyxDQUNELFNBQVMsQ0FBRSxPQUFPLENBQ2xCLFVBQVUsQ0FBRSxDQUNWLE9BQU8sQ0FBRSxtQkFBbUIsQ0FDNUIsV0FBVyxDQUFFLHdDQUNmLENBQUMsQ0FDRCxNQUFNLENBQUUsQ0FDTixPQUFPLENBQUUsaUJBQWlCLENBQzFCLFdBQVcsQ0FBRSxzQ0FDZixDQUNGLENBQUMsQ0FDTSxHQUFNQyxPQUFNLENBQUcsQ0FFdEIsQ0FBQyxDQUdNLEdBQU1DLElBQUcsQ0FBRyxDQUFDLENBQ2xCQyxLQUFLLENBQUUsb0JBQW9CLENBQzNCUCxFQUFFLENBQUUsb0JBQW9CLENBQ3hCUSxLQUFLLENBQUUsQ0FDVCxDQUFDLENBQUUsQ0FDREQsS0FBSyxDQUFFLFVBQVUsQ0FDakJQLEVBQUUsQ0FBRSxVQUFVLENBQ2RRLEtBQUssQ0FBRSxDQUNULENBQUMsQ0FBRSxDQUNERCxLQUFLLENBQUUsZ0JBQWdCLENBQ3ZCUCxFQUFFLENBQUUsZ0JBQWdCLENBQ3BCUSxLQUFLLENBQUUsQ0FDVCxDQUFDLENBQUUsQ0FDREQsS0FBSyxDQUFFLGVBQWUsQ0FDdEJQLEVBQUUsQ0FBRSxlQUFlLENBQ25CUSxLQUFLLENBQUUsQ0FDVCxDQUFDLENBQUUsQ0FDREQsS0FBSyxDQUFFLG9CQUFvQixDQUMzQlAsRUFBRSxDQUFFLG9CQUFvQixDQUN4QlEsS0FBSyxDQUFFLENBQ1QsQ0FBQyxDQUFFLENBQ0RELEtBQUssQ0FBRSxPQUFPLENBQ2RQLEVBQUUsQ0FBRSxPQUFPLENBQ1hRLEtBQUssQ0FBRSxDQUNULENBQUMsQ0FBQyxDQUVGLEdBQU1DLFlBQVcsQ0FBRyxDQUNsQkgsR0FBRyxDQUFIQSxHQUNGLENBQUMsQ0FDRCxHQUFNSSxVQUFTLENBQUcsU0FBUyxDQUNaLFFBQVNDLFdBQVUsTUFHL0IsSUFGREMsV0FBVSxNQUFWQSxVQUFVLENBQ1BDLEtBQUssc0xBRVIsTUFBTyw4REFBQyxTQUFTLG9KQUFLSixXQUFXLENBQU1JLEtBQUssRUFBRSxVQUFVLENBQUVELFVBQVcsQ0FBQyxPQUFPLENBQUMsV0FBVyxHQUV2RiwyRUFDRSxPQUFPLENBQUUsbUJBQW1CLENBQzVCLE1BQU0sQ0FBRSxTQUFTLEVBQ2hCLGtFQUFHLFVBQVUsQ0FBQyxZQUFZLDJFQUErRSxtRUFBRyxVQUFVLENBQUMsWUFBWSxzRUFBMEUsQ0FBYSxDQUM3TiwyRUFDRSxNQUFNLENBQUUsS0FBSyxFQUNaLGtFQUFHLFVBQVUsQ0FBQyxZQUFZLHlDQUF5QyxrRUFBRyxVQUFVLENBQUMsR0FBRyxDQUNqRixNQUFNLENBQUUsbUJBQW1CLDRCQUNLLDBDQUE4QyxDQUFhLENBQ2pHLDZWQUErUixDQUMvUiwrUkFBaU8sQ0FDak8sME5BQTRKLENBQzVKLDJFQUNFLE9BQU8sQ0FBRSxpQkFBaUIsQ0FDMUIsTUFBTSxDQUFFLEtBQUssRUFDWixtRUFBSSxVQUFVLENBQUMsWUFBWSxFQUMxQixtRUFBSSxVQUFVLENBQUMsSUFBSSxzRUFBMkUsQ0FDOUYsbUVBQUksVUFBVSxDQUFDLElBQUkscUZBQTBGLENBQzFHLENBQWEsQ0FDcEIsbUVBQ0UsSUFBSSxDQUFFLG9CQUFvQix1QkFDRSxDQUM5QixzTkFBd0osQ0FDeEosdUVBQ0UsbUVBQUksVUFBVSxDQUFDLElBQUksbUVBQXdFLENBQzNGLG1FQUFJLFVBQVUsQ0FBQyxJQUFJLGtKQUF1SixDQUMxSyxtRUFBSSxVQUFVLENBQUMsSUFBSSx5TUFBOE0sQ0FDOU4sQ0FDTCw4WUFBZ1YsQ0FDaFYsd09BQTBLLENBQzFLLDBWQUE0UixDQUM1UixtRUFDRSxJQUFJLENBQUUsVUFBVSxhQUNFLENBQ3BCLHdPQUEwSyxDQUMxSyxpYkFBbVgsQ0FDblgsd0VBQUsscUVBQU0sVUFBVSxDQUFDLEtBQUssQ0FDdkIsV0FBVyxDQUFFLGFBQWEsQ0FDMUIsWUFBWSxDQUFFLHVCQUF1QixDQUNyQyxNQUFNLENBQUUsSUFBSSxDQUNaLFdBQVcsQ0FBRSxRQUFRLHlQQWFwQixDQUFNLENBQ1gsdUdBQXlDLENBQ3pDLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxhQUFhLENBQzFCLFlBQVksQ0FBRSx1QkFBdUIsQ0FDckMsTUFBTSxDQUFFLElBQUksQ0FDWixXQUFXLENBQUUsUUFBUSwwb0JBMkJwQixDQUFNLENBQ1gsMk9BQTZLLENBQzdLLDZRQUErTSxDQUMvTSxtRUFDRSxJQUFJLENBQUUsZ0JBQWdCLG1CQUNFLENBQzFCLDJKQUE2RixDQUM3Rix3RUFBSyxxRUFBTSxVQUFVLENBQUMsS0FBSyxDQUN2QixXQUFXLENBQUUsYUFBYSxrVUFlekIsQ0FBTSxDQUNYLDJFQUNFLE1BQU0sQ0FBRSxLQUFLLEVBQ1osa0VBQUcsVUFBVSxDQUFDLFlBQVksb0lBQXdJLENBQWEsQ0FDbEwsaUtBQW1HLENBQ25HLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxhQUFhLDZYQWdCekIsQ0FBTSxDQUNYLGlSQUFpTixDQUNqTix3RUFBSyxxRUFBTSxVQUFVLENBQUMsS0FBSyxDQUN2QixXQUFXLENBQUUsYUFBYSxzWEFnQnpCLENBQU0sQ0FDWCxvR0FBc0MsQ0FDdEMsd0VBQUsscUVBQU0sVUFBVSxDQUFDLEtBQUssQ0FDdkIsV0FBVyxDQUFFLGFBQWEsNmFBZ0J6QixDQUFNLENBQ1gsZ0ZBQWMsMkVBQVksVUFBVSxDQUFDLEdBQUcsYUFBMEIsU0FBUywyRUFBWSxVQUFVLENBQUMsR0FBRyxhQUEwQixnREFBb0QsQ0FDbkwsZ0hBQThDLDJFQUFZLFVBQVUsQ0FBQyxHQUFHLGNBQTJCLDBHQUEwRywyRUFBWSxVQUFVLENBQUMsR0FBRyxTQUFzQixLQUFLLDJFQUFZLFVBQVUsQ0FBQyxHQUFHLFNBQXNCLHFEQUF5RCxDQUMzVyxrSUFBb0UsQ0FDcEUsd0VBQUsscUVBQU0sVUFBVSxDQUFDLEtBQUssQ0FDdkIsV0FBVyxDQUFFLGFBQWEsOFdBY3pCLENBQU0sQ0FDWCw0TkFBOEosQ0FDOUosMlRBQTZQLENBQzdQLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxhQUFhLHNYQWF6QixDQUFNLENBQ1gsa0tBQWdHLDJFQUFZLFVBQVUsQ0FBQyxHQUFHLFNBQXNCLFVBQWMsQ0FDOUosd0VBQUsscUVBQU0sVUFBVSxDQUFDLEtBQUssQ0FDdkIsV0FBVyxDQUFFLGNBQWMsQ0FDM0IsWUFBWSxDQUFFLDJEQUEyRCxDQUN6RSxNQUFNLENBQUUsSUFBSSxDQUNaLGFBQWEsQ0FBRSw0QkFBNEIsQ0FDM0MsV0FBVyxDQUFFLEtBQUssczJFQW9HakIsQ0FBTSxDQUNYLG1FQUNFLElBQUksQ0FBRSxlQUFlLGtCQUNFLENBQ3pCLGtUQUFvUCxDQUNwUCx3RUFBSyxxRUFBTSxVQUFVLENBQUMsS0FBSyxDQUN2QixXQUFXLENBQUUsYUFBYSxvbUNBeUN6QixDQUFNLENBQ1gsdUZBQXlCLENBQ3pCLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxhQUFhLGtuQkF3QnpCLENBQU0sQ0FDWCxpVUFBbVEsQ0FDblEsc0pBQXdGLENBQ3hGLHdLQUFzRywyRUFBWSxVQUFVLENBQUMsR0FBRyxtQkFBZ0Msa0VBQXNFLENBQ3RPLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxhQUFhLGkrQkFtQ3pCLENBQU0sQ0FDWCx1RkFBeUIsQ0FDekIsd0VBQUsscUVBQU0sVUFBVSxDQUFDLEtBQUssQ0FDdkIsV0FBVyxDQUFFLGNBQWMsNlNBYzFCLENBQU0sQ0FDWCx3UkFBME4sQ0FDMU4sMkZBQTZCLENBQzdCLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxjQUFjLENBQzNCLFlBQVksQ0FBRSwwREFBMEQsQ0FDeEUsTUFBTSxDQUFFLElBQUksQ0FDWixhQUFhLENBQUUsMkJBQTJCLENBQzFDLFdBQVcsQ0FBRSxLQUFLLGd6RUFnR2pCLENBQU0sQ0FDWCxtRUFDRSxJQUFJLENBQUUsb0JBQW9CLHVCQUNFLENBQzlCLDJFQUNFLE1BQU0sQ0FBRSxLQUFLLEVBQ1osa0VBQUcsVUFBVSxDQUFDLFlBQVksNkNBQTZDLGtFQUFHLFVBQVUsQ0FBQyxHQUFHLENBQ3JGLE1BQU0sQ0FBRSxTQUFTLFlBQ0QsZ0RBQW9ELENBQWEsQ0FDdkYseVBBQTJMLENBQzNMLCtIQUE2RCxrRUFBRyxVQUFVLENBQUMsR0FBRyxDQUMxRSxNQUFNLENBQUUseUNBQXlDLEVBQ2hELDJFQUFZLFVBQVUsQ0FBQyxHQUFHLGlCQUE4QixRQUFZLEtBQVMsQ0FDbEYsd0VBQUsscUVBQU0sVUFBVSxDQUFDLEtBQUssQ0FDdkIsV0FBVyxDQUFFLGFBQWEsb05BVXpCLENBQU0sQ0FDWCw0TkFBOEosQ0FDOUosMkpBQXlGLGtFQUFHLFVBQVUsQ0FBQyxHQUFHLENBQ3RHLE1BQU0sQ0FBRSxvQ0FBb0MsRUFDM0MsMkVBQVksVUFBVSxDQUFDLEdBQUcsMEJBQXVDLENBQUksS0FBUyxDQUNuRix3RUFBSyxxRUFBTSxVQUFVLENBQUMsS0FBSyxDQUN2QixXQUFXLENBQUUsYUFBYSw4U0FhekIsQ0FBTSxDQUNYLDBIQUF3RCxrRUFBRyxVQUFVLENBQUMsR0FBRyxDQUNyRSxNQUFNLENBQUUsaUNBQWlDLEVBQ3hDLDJFQUFZLFVBQVUsQ0FBQyxHQUFHLFdBQXdCLENBQUkscUNBQXFDLDJFQUFZLFVBQVUsQ0FBQyxHQUFHLGlCQUE4QixnQkFBb0IsQ0FDNUssMkdBQXlDLDJFQUFZLFVBQVUsQ0FBQyxHQUFHLGlCQUE4Qix5REFBeUQsMkVBQVksVUFBVSxDQUFDLEdBQUcsY0FBMkIsc0hBQTBILENBQ3pVLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxhQUFhLHMyQkErQnpCLENBQU0sQ0FDWCxpSUFBK0Qsa0VBQUcsVUFBVSxDQUFDLEdBQUcsQ0FDNUUsTUFBTSxDQUFFLG9CQUFvQixFQUMzQiwyRUFBWSxVQUFVLENBQUMsR0FBRyxXQUF3QixvQkFBd0Isb0RBQW9ELDJFQUFZLFVBQVUsQ0FBQyxHQUFHLFdBQXdCLGdDQUFnQywyRUFBWSxVQUFVLENBQUMsR0FBRyxTQUFzQixTQUFTLDJFQUFZLFVBQVUsQ0FBQyxHQUFHLFNBQXNCLFlBQWdCLENBQzlVLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxhQUFhLHUrREFxRXpCLENBQU0sQ0FDWCw4R0FBNEMsMkVBQVksVUFBVSxDQUFDLEdBQUcsc0JBQW1DLGtOQUFzTixDQUMvVCxrS0FBb0csQ0FDcEcsc0hBQW9ELDJFQUFZLFVBQVUsQ0FBQyxHQUFHLGtCQUErQix1SUFBdUksMkVBQVksVUFBVSxDQUFDLEdBQUcsV0FBd0IseUNBQTZDLENBQ25WLHlRQUEyTSxDQUMzTSx3RUFBSyxxRUFBTSxVQUFVLENBQUMsS0FBSyxDQUN2QixXQUFXLENBQUUsYUFBYSxtbEVBeUV6QixDQUFNLENBQ1gsbUdBQXFDLENBQ3JDLHdFQUFLLHFFQUFNLFVBQVUsQ0FBQyxLQUFLLENBQ3ZCLFdBQVcsQ0FBRSxjQUFjLENBQzNCLFlBQVksQ0FBRSxnRUFBZ0UsQ0FDOUUsTUFBTSxDQUFFLElBQUksQ0FDWixhQUFhLENBQUUsdUJBQXVCLENBQ3RDLFdBQVcsQ0FBRSxJQUFJLENBQ2pCLFdBQVcsQ0FBRSxLQUFLLG82R0F1SWpCLENBQU0sQ0FDWCxtRUFDRSxJQUFJLENBQUUsT0FBTyxVQUNFLENBQ2pCLHVFQUNFLG1FQUFJLFVBQVUsQ0FBQyxJQUFJLHdGQUE2RixDQUNoSCxtRUFBSSxVQUFVLENBQUMsSUFBSSwwRUFBK0UsQ0FDbEcsbUVBQUksVUFBVSxDQUFDLElBQUksb0hBQXlILENBQzVJLG1FQUFJLFVBQVUsQ0FBQyxJQUFJLHlJQUE4SSxDQUNqSyxtRUFBSSxVQUFVLENBQUMsSUFBSSx1R0FBNEcsQ0FDL0gsbUVBQUksVUFBVSxDQUFDLElBQUksNElBQWlKLENBQ3BLLG1FQUFJLFVBQVUsQ0FBQyxJQUFJLHNDQUEyQyxDQUMzRCxDQUNPLENBQ2hCLENBQ0EsQ0FDQUQsVUFBVSxDQUFDRyxjQUFjLENBQUcsSUFBSSIsInNvdXJjZXMiOlsid2VicGFjazovL3plZHV4LWRvY3MvLi9kb2NzL2FkdmFuY2VkL3RpbWUtdHJhdmVsLm1keD9mYjMwIl0sInNvdXJjZXNDb250ZW50IjpbIlxuXG4vKiBAanN4UnVudGltZSBjbGFzc2ljICovXG4vKiBAanN4IG1keCAqL1xuLyogQGpzeEZyYWcgUmVhY3QuRnJhZ21lbnQgKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IG1keCB9IGZyb20gJ0BtZHgtanMvcmVhY3QnO1xuXG5cbmV4cG9ydCBjb25zdCBmcm9udE1hdHRlciA9IHtcblx0aWQ6ICd0aW1lLXRyYXZlbCcsXG5cdHRpdGxlOiAnVGltZSBUcmF2ZWwnXG59O1xuZXhwb3J0IGNvbnN0IGNvbnRlbnRUaXRsZSA9IHVuZGVmaW5lZDtcbmV4cG9ydCBjb25zdCBtZXRhZGF0YSA9IHtcbiAgXCJ1bnZlcnNpb25lZElkXCI6IFwiYWR2YW5jZWQvdGltZS10cmF2ZWxcIixcbiAgXCJpZFwiOiBcImFkdmFuY2VkL3RpbWUtdHJhdmVsXCIsXG4gIFwidGl0bGVcIjogXCJUaW1lIFRyYXZlbFwiLFxuICBcImRlc2NyaXB0aW9uXCI6IFwiVGhpcyBndWlkZSBpcyB2ZXJ5IGxvdy1sZXZlbC4gRGV2IHRvb2xzIHNob3VsZCBpbXBsZW1lbnQgdGhpcyBmb3IgeW91LlwiLFxuICBcInNvdXJjZVwiOiBcIkBzaXRlL2RvY3MvYWR2YW5jZWQvdGltZS10cmF2ZWwubWR4XCIsXG4gIFwic291cmNlRGlyTmFtZVwiOiBcImFkdmFuY2VkXCIsXG4gIFwic2x1Z1wiOiBcIi9hZHZhbmNlZC90aW1lLXRyYXZlbFwiLFxuICBcInBlcm1hbGlua1wiOiBcIi96ZWR1eC9kb2NzL2FkdmFuY2VkL3RpbWUtdHJhdmVsXCIsXG4gIFwiZHJhZnRcIjogZmFsc2UsXG4gIFwiZWRpdFVybFwiOiBcImh0dHBzOi8vZ2l0aHViLmNvbS9PbW5pc3RhYy96ZWR1eC90cmVlL21hc3Rlci9kb2NzL2FkdmFuY2VkL3RpbWUtdHJhdmVsLm1keFwiLFxuICBcInRhZ3NcIjogW10sXG4gIFwidmVyc2lvblwiOiBcImN1cnJlbnRcIixcbiAgXCJmcm9udE1hdHRlclwiOiB7XG4gICAgXCJpZFwiOiBcInRpbWUtdHJhdmVsXCIsXG4gICAgXCJ0aXRsZVwiOiBcIlRpbWUgVHJhdmVsXCJcbiAgfSxcbiAgXCJzaWRlYmFyXCI6IFwicmVhY3RcIixcbiAgXCJwcmV2aW91c1wiOiB7XG4gICAgXCJ0aXRsZVwiOiBcIlN0b3JlIENvbXBvc2l0aW9uXCIsXG4gICAgXCJwZXJtYWxpbmtcIjogXCIvemVkdXgvZG9jcy9hZHZhbmNlZC9zdG9yZS1jb21wb3NpdGlvblwiXG4gIH0sXG4gIFwibmV4dFwiOiB7XG4gICAgXCJ0aXRsZVwiOiBcIlR5cGVTY3JpcHQgVGlwc1wiLFxuICAgIFwicGVybWFsaW5rXCI6IFwiL3plZHV4L2RvY3MvYWR2YW5jZWQvdHlwZXNjcmlwdC10aXBzXCJcbiAgfVxufTtcbmV4cG9ydCBjb25zdCBhc3NldHMgPSB7XG5cbn07XG5cblxuZXhwb3J0IGNvbnN0IHRvYyA9IFt7XG4gIHZhbHVlOiAnVGltZSBUcmF2ZWwgQmFzaWNzJyxcbiAgaWQ6ICd0aW1lLXRyYXZlbC1iYXNpY3MnLFxuICBsZXZlbDogMlxufSwge1xuICB2YWx1ZTogJ0luIFplZHV4JyxcbiAgaWQ6ICdpbi16ZWR1eCcsXG4gIGxldmVsOiAyXG59LCB7XG4gIHZhbHVlOiAnU3RvcmUgVHJhdmVsZXInLFxuICBpZDogJ3N0b3JlLXRyYXZlbGVyJyxcbiAgbGV2ZWw6IDJcbn0sIHtcbiAgdmFsdWU6ICdBdG9tIFRyYXZlbGVyJyxcbiAgaWQ6ICdhdG9tLXRyYXZlbGVyJyxcbiAgbGV2ZWw6IDJcbn0sIHtcbiAgdmFsdWU6ICdFY29zeXN0ZW0gVHJhdmVsZXInLFxuICBpZDogJ2Vjb3N5c3RlbS10cmF2ZWxlcicsXG4gIGxldmVsOiAyXG59LCB7XG4gIHZhbHVlOiAnUmVjYXAnLFxuICBpZDogJ3JlY2FwJyxcbiAgbGV2ZWw6IDJcbn1dO1xuXG5jb25zdCBsYXlvdXRQcm9wcyA9IHtcbiAgdG9jXG59O1xuY29uc3QgTURYTGF5b3V0ID0gXCJ3cmFwcGVyXCJcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIE1EWENvbnRlbnQoe1xuICBjb21wb25lbnRzLFxuICAuLi5wcm9wc1xufSkge1xuICByZXR1cm4gPE1EWExheW91dCB7Li4ubGF5b3V0UHJvcHN9IHsuLi5wcm9wc30gY29tcG9uZW50cz17Y29tcG9uZW50c30gbWR4VHlwZT1cIk1EWExheW91dFwiPlxuXG4gICAgPGFkbW9uaXRpb24gey4uLntcbiAgICAgIFwidGl0bGVcIjogXCJsb3ctbGV2ZWwgd2FybmluZ1wiLFxuICAgICAgXCJ0eXBlXCI6IFwiY2F1dGlvblwiXG4gICAgfX0+PHAgcGFyZW50TmFtZT1cImFkbW9uaXRpb25cIj57YFRoaXMgZ3VpZGUgaXMgdmVyeSBsb3ctbGV2ZWwuIERldiB0b29scyBzaG91bGQgaW1wbGVtZW50IHRoaXMgZm9yIHlvdS5gfTwvcD48cCBwYXJlbnROYW1lPVwiYWRtb25pdGlvblwiPntgSWYgeW91J3JlIG5ldyBoZXJlLCB5b3UgcHJvYmFibHkgZG9uJ3Qgd2FudCB0byByZWFkIHRoaXMgZG9jIHlldC5gfTwvcD48L2FkbW9uaXRpb24+XG4gICAgPGFkbW9uaXRpb24gey4uLntcbiAgICAgIFwidHlwZVwiOiBcInRpcFwiXG4gICAgfX0+PHAgcGFyZW50TmFtZT1cImFkbW9uaXRpb25cIj57YFRoaXMgZ3VpZGUgYXNzdW1lcyBrbm93bGVkZ2Ugb2YgdGhlIGB9PGEgcGFyZW50TmFtZT1cInBcIiB7Li4ue1xuICAgICAgICAgIFwiaHJlZlwiOiBcInN0b3JlLWNvbXBvc2l0aW9uXCJcbiAgICAgICAgfX0+e2BzdG9yZSBjb21wb3NpdGlvbiBndWlkZWB9PC9hPntgLiBJdCdzIHJlY29tbWVuZGVkIHRvIHJlYWQgdGhhdCBmaXJzdC5gfTwvcD48L2FkbW9uaXRpb24+XG4gICAgPHA+e2BSZWR1eCBwb3B1bGFyaXplZCB0aGUgYWJpbGl0eSB0byB1bmRvIGFuZCByZWRvIHN0YXRlIHVwZGF0ZXMgaW4geW91ciBhcHAuIEVhcmxpZXIgZmx1eCBtb2RlbHMgZGlkbid0IGhhdmUgdGhpcyBjYXBhYmlsaXR5IGJlY2F1c2UgdGhleSBzcGxpdCBzdGF0ZSB1cCBhY3Jvc3MgbXVsdGlwbGUgc3RvcmVzLiBXZWxsIFplZHV4IHJlaW50cm9kdWNlcyB0aGUgY29uY2VwdCBvZiBtdWx0aXBsZSBzdG9yZXMsIHNvIGRvZXMgdGhhdCBtZWFuIGl0IGxvc2VzIG91dCBvbiB0aW1lIHRyYXZlbD9gfTwvcD5cbiAgICA8cD57YFplZHV4IGFsc28gaW50cm9kdWNlcyB0aGUgY29uY2VwdCBvZiB6ZXJvLWNvbmZpZyBzdG9yZXMuIEluIFJlZHV4LCB0aGUgYm9pbGVycGxhdGUtaGVhdnkgYWN0aW9uLXJlZHVjZXIgbW9kZWwgaXMgY2VudHJhbCB0byBpdHMgdGltZSB0cmF2ZWxpbmcgYWJpbGl0eS4gU3VyZWx5IHplcm8tY29uZmlnIFplZHV4IHN0b3JlcyBjYW4ndCB0aW1lIHRyYXZlbC4uLiBDYW4gdGhleT9gfTwvcD5cbiAgICA8cD57YEFzIHlvdSBjYW4gcHJvYmFibHkgZ3Vlc3MgYnkgdGhlIGV4aXN0ZW5jZSBvZiB0aGlzIHdhbGt0aHJvdWdoIHBhZ2UsIHRoZSBhbnN3ZXIgaXMgdGhhdCBaZWR1eCBmdWxseSBzdXBwb3J0cyB0aW1lIHRyYXZlbC4gTGV0J3MgTGVhcm4gRXZlcnl0aGluZy5gfTwvcD5cbiAgICA8YWRtb25pdGlvbiB7Li4ue1xuICAgICAgXCJ0aXRsZVwiOiBcInlvdSB3aWxsIGxlYXJuOlwiLFxuICAgICAgXCJ0eXBlXCI6IFwidGlwXCJcbiAgICB9fT48dWwgcGFyZW50TmFtZT1cImFkbW9uaXRpb25cIj5cbiAgICAgICAgPGxpIHBhcmVudE5hbWU9XCJ1bFwiPntgSG93IFplZHV4J3MgcG93ZXJmdWwgc3RvcmUgY29tcG9zaXRpb24gbW9kZWwgZW5hYmxlcyB0aW1lIHRyYXZlbC5gfTwvbGk+XG4gICAgICAgIDxsaSBwYXJlbnROYW1lPVwidWxcIj57YEhvdyB0byBpbXBsZW1lbnQgdW5kby9yZWRvIGZvciBpbmRpdmlkdWFsIHN0b3JlcywgYXRvbXMsIG9yIGFuIGVudGlyZSBlY29zeXN0ZW0uYH08L2xpPlxuICAgICAgPC91bD48L2FkbW9uaXRpb24+XG4gICAgPGgyIHsuLi57XG4gICAgICBcImlkXCI6IFwidGltZS10cmF2ZWwtYmFzaWNzXCJcbiAgICB9fT57YFRpbWUgVHJhdmVsIEJhc2ljc2B9PC9oMj5cbiAgICA8cD57YEZpcnN0IG9mZiwgdGltZSB0cmF2ZWwgaGFzIHNldmVyYWwgb3ZlcmxhcHBpbmcgY29uY2VwdHMsIHdpdGggZGlmZmVyaW5nIG9waW5pb25zIGFib3V0IHdoYXQgdGhleSBtZWFuLiBUaGlzIGd1aWRlIHdpbGwgYXNzdW1lIHRoZXNlIG1lYW5pbmdzOmB9PC9wPlxuICAgIDx1bD5cbiAgICAgIDxsaSBwYXJlbnROYW1lPVwidWxcIj57YFVuZG8vUmVkbyAtIFN0ZXAgYmFja3dhcmQgYW5kIGZvcndhcmQgdGhyb3VnaCBhIHN0YXRlIGhpc3RvcnkuYH08L2xpPlxuICAgICAgPGxpIHBhcmVudE5hbWU9XCJ1bFwiPntgUmVwbGF5YWJsZSBBY3Rpb25zIC0gR2l2ZW4gYSBsaXN0IG9mIGFjdGlvbnMgYW5kIGEgc3RhcnRpbmcgc3RhdGUsIGRpc3BhdGNoIHRob3NlIGFjdGlvbnMgb25lLWJ5LW9uZSB0byBjb25zaXN0ZW50bHkgYXJyaXZlIGF0IGEgZmluYWwgc3RhdGUuYH08L2xpPlxuICAgICAgPGxpIHBhcmVudE5hbWU9XCJ1bFwiPntgVGltZSBUcmF2ZWwgLSBUaGUgb3ZlcmFyY2hpbmcgY29uY2VwdCBjb250YWluaW5nIGJvdGggdW5kby9yZWRvIGFuZCByZXBsYXlhYmxlIGFjdGlvbnMsIGFkZGluZyB0aGUgYWJpbGl0eSB0byBqdW1wIGJhY2t3YXJkIHNldmVyYWwgc3RhdGVzIGF0IGEgdGltZSBvciBmb3J3YXJkIHNldmVyYWwgc3RhdGVzIG9yIGFjdGlvbnMgYXQgYSB0aW1lLmB9PC9saT5cbiAgICA8L3VsPlxuICAgIDxwPntgVW5kby9yZWRvIGlzIGNvb2wsIGJ1dCBtb3JlIGxpbWl0ZWQsIHNpbmNlIGl0IGRvZXNuJ3QgZGlzcGF0Y2ggYWN0aW9ucyBleGFjdGx5IGhvdyB0aGV5IHdlcmUgb3JpZ2luYWxseSBkaXNwYXRjaGVkLiBUaGlzIG1lYW5zIHVuZG8vcmVkbyBjYW4gc2tpcCBzaWRlIGVmZmVjdHMgb3IgcnVuIHRoZW0gaW4gYW4gZW50aXJlbHkgZGlmZmVyZW50IHdheSB0aGFuIHRoZSByZWFsIGFwcC4gSG93ZXZlciwgaWYgeW91IG1hbmFnZSB0byBkZXNpZ24geW91ciBzaWRlIGVmZmVjdHMgYXJvdW5kIHRoaXMgKG5pZ2ggaW1wb3NzaWJsZSksIGl0IGNhbiBiZSB2ZXJ5IHBvd2VyZnVsLmB9PC9wPlxuICAgIDxwPntgUmVwbGF5YWJsZSBhY3Rpb25zIG1vcmUgZmFpdGhmdWxseSByZXBsaWNhdGUgc3RhdGUgY2hhbmdlcy4gSW4gWmVkdXgsIGFsbCBzdGF0ZSBjaGFuZ2VzIHByb2R1Y2UgYW4gYWN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gZnVsbHkgcmVwcm9kdWNlIHRoZSBzdGF0ZSBjaGFuZ2UuYH08L3A+XG4gICAgPHA+e2BaZWR1eCBoYXMgZnVsbCBzdXBwb3J0IGZvciBib3RoIGtpbmRzIG9mIHRpbWUgdHJhdmVsIGF0IHRoZSBzdG9yZSwgYXRvbSBpbnN0YW5jZSwgYW5kIGVjb3N5c3RlbSBsZXZlbHMuIFRoaXMgZ3VpZGUgd2lsbCBkZW1vbnN0cmF0ZSB1bmRvL3JlZG8gc2luY2UgaXQncyBnZW5lcmFsbHkgc2ltcGxlciwgYnV0IHRoZSBoaWdoLWxldmVsIGNvbmNlcHRzIHNob3VsZCBhbHNvIGdpdmUgZW5vdWdoIGluc2lnaHQgaW50byBob3cgdG8gaW1wbGVtZW50IHJlcGxheWFibGUgYWN0aW9ucy5gfTwvcD5cbiAgICA8aDIgey4uLntcbiAgICAgIFwiaWRcIjogXCJpbi16ZWR1eFwiXG4gICAgfX0+e2BJbiBaZWR1eGB9PC9oMj5cbiAgICA8cD57YEV2ZXJ5IHN0YXRlIHVwZGF0ZSBpbiBaZWR1eCBpcyB0cmFja2FibGUgYW5kIHJlcHJvZHVjaWJsZS4gV2hlbiB0cmFja2luZyBjaGFuZ2VzIGluIGEgY29tcG9zZWQgc3RvcmUgaGllcmFyY2h5LCB5b3Ugb25seSBuZWVkIG9uZSBzdWJzY3JpYmVyIGluIHRoZSByb290IHN0b3JlLmB9PC9wPlxuICAgIDxwPntgRXZlcnkgcGFyZW50IHN0b3JlIGlzIGFibGUgdG8gdHJhY2sgYW5kIHJlcHJvZHVjZSBldmVyeSBzdGF0ZSBjaGFuZ2UgYW55d2hlcmUgaW4gaXRzIGNoaWxkcmVuLCBncmFuZGNoaWxkcmVuLCBldGMuIFRoYXQgbWVhbnMgYSBzdWJzY3JpYmVyIGF0dGFjaGVkIHRvIHRoZSBwYXJlbnQgc3RvcmUgcmVjZWl2ZXMgYWN0aW9ucyB0aGF0IGNhbiBiZSB1c2VkIHRvIHJlcHJvZHVjZSBldmVyeSBzdGF0ZSBjaGFuZ2UgKHVzZWZ1bCBmb3IgcmVwbGF5YWJsZSBhY3Rpb25zKS4gQWxzbywgc2V0dGluZyBzdGF0ZSBvbiB0aGUgcGFyZW50IHN0b3JlIGRpcmVjdGx5IHVwZGF0ZXMgaXRzIGNoaWxkcmVuICh1c2VmdWwgZm9yIHVuZG8vcmVkbykuYH08L3A+XG4gICAgPHByZT48Y29kZSBwYXJlbnROYW1lPVwicHJlXCIgey4uLntcbiAgICAgICAgXCJjbGFzc05hbWVcIjogXCJsYW5ndWFnZS10c1wiLFxuICAgICAgICBcIm1ldGFzdHJpbmdcIjogXCJsaXZlIHJlc3VsdFZhcj1vdXRwdXRcIixcbiAgICAgICAgXCJsaXZlXCI6IHRydWUsXG4gICAgICAgIFwicmVzdWx0VmFyXCI6IFwib3V0cHV0XCJcbiAgICAgIH19PntgY29uc3QgcGFyZW50ID0gY3JlYXRlU3RvcmUoKVxuY29uc3QgY2hpbGQgPSBjcmVhdGVTdG9yZSgpXG5cbnBhcmVudC51c2UoeyBjaGlsZCB9KVxuXG5jaGlsZC5zZXRTdGF0ZSgnaW5pdGlhbCBzdGF0ZScpXG5wYXJlbnQuc2V0U3RhdGUoeyBjaGlsZDogJ2JldHRlciBzdGF0ZScgfSlcblxuY29uc3Qgb3V0cHV0ID0ge1xuICBjaGlsZDogY2hpbGQuZ2V0U3RhdGUoKSxcbiAgcGFyZW50OiBwYXJlbnQuZ2V0U3RhdGUoKSxcbn1cbmB9PC9jb2RlPjwvcHJlPlxuICAgIDxwPntgVG8gdHJhY2sgYW5kIHJlcGxheSBhbiBhY3Rpb246YH08L3A+XG4gICAgPHByZT48Y29kZSBwYXJlbnROYW1lPVwicHJlXCIgey4uLntcbiAgICAgICAgXCJjbGFzc05hbWVcIjogXCJsYW5ndWFnZS10c1wiLFxuICAgICAgICBcIm1ldGFzdHJpbmdcIjogXCJsaXZlIHJlc3VsdFZhcj1vdXRwdXRcIixcbiAgICAgICAgXCJsaXZlXCI6IHRydWUsXG4gICAgICAgIFwicmVzdWx0VmFyXCI6IFwib3V0cHV0XCJcbiAgICAgIH19PntgY29uc3QgcGFyZW50ID0gY3JlYXRlU3RvcmUoKVxuY29uc3QgY2hpbGQgPSBjcmVhdGVTdG9yZSgpXG5cbnBhcmVudC51c2UoeyBjaGlsZCB9KVxuXG4vLyBmb3IgdGhpcyBleGFtcGxlLCB3ZSdsbCB0cmFjayBvbmUgYWN0aW9uIGFuZCByZS1kaXNwYXRjaCBpdDpcbmxldCB0cmFja2VkQWN0aW9uXG5cbnBhcmVudC5zdWJzY3JpYmUoe1xuICBlZmZlY3RzOiAoeyBhY3Rpb24gfSkgPT4ge1xuICAgIGlmICghdHJhY2tlZEFjdGlvbikgdHJhY2tlZEFjdGlvbiA9IGFjdGlvblxuICB9LFxufSlcblxuLy8gY3JlYXRlcyBhIFwicHNldWRvLWFjdGlvblwiXG5jaGlsZC5zZXRTdGF0ZSgnaW5pdGlhbCBzdGF0ZScpIC8vIHdlJ2xsIHRyYWNrIHRoaXMgc3RhdGUgLi4uXG5jaGlsZC5zZXRTdGF0ZSgnYmV0dGVyIHN0YXRlJykgLy8gLi4uIGFuZCB1c2UgaXQgdG8gb3ZlcnJpZGUgdGhpcyBzdGF0ZVxuXG4vLyBkaXNwYXRjaCB0aGUgdHJhY2tlZCBhY3Rpb24gZGlyZWN0bHkgdG8gdGhlIHBhcmVudCBzdG9yZTpcbnBhcmVudC5kaXNwYXRjaCh0cmFja2VkQWN0aW9uKVxuXG5jb25zdCBvdXRwdXQgPSB7XG4gIGNoaWxkOiBjaGlsZC5nZXRTdGF0ZSgpLFxuICBwYXJlbnQ6IHBhcmVudC5nZXRTdGF0ZSgpLFxuICB0cmFja2VkQWN0aW9uLFxufVxuYH08L2NvZGU+PC9wcmU+XG4gICAgPHA+e2BCb3R0b20gbGluZTogSW4gWmVkdXgsIHlvdSBvbmx5IG5lZWQgYWNjZXNzIHRvIHRoZSBwYXJlbnQgc3RvcmUgYW5kIHlvdSdyZSBnb2xkZW4uIEF0b21zIG5hdHVyYWxseSBleHBvc2UgZXhhY3RseSBvbmUgcGFyZW50IHN0b3JlLCBzbyB0aGlzIHdvcmtzIG91dCBiZWF1dGlmdWxseS5gfTwvcD5cbiAgICA8cD57YFRoZSByZXN0IG9mIHRoaXMgZ3VpZGUgd2lsbCB3YWxrIHRocm91Z2ggc3BlY2lmaWMgcG9zc2libGUgaW1wbGVtZW50YXRpb25zIG9mIHVuZG8vcmVkby4gWW91IHNob3VsZCBwcm9iYWJseSBub3QgYmUgaW1wbGVtZW50aW5nIHRpbWUgdHJhdmVsIHlvdXJzZWxmLCBidXQgaWYgeW91J3JlIGN1cmlvdXMsIGJ5IGFsbCBtZWFucyBjb250aW51ZS5gfTwvcD5cbiAgICA8aDIgey4uLntcbiAgICAgIFwiaWRcIjogXCJzdG9yZS10cmF2ZWxlclwiXG4gICAgfX0+e2BTdG9yZSBUcmF2ZWxlcmB9PC9oMj5cbiAgICA8cD57YFRvIGltcGxlbWVudCB1bmRvL3JlZG8gZm9yIGEgc3RvcmUsIGZpcnN0IGF0dGFjaCBhIHN1YnNjcmliZXIgdG8gdGhlIHBhcmVudCBzdG9yZTpgfTwvcD5cbiAgICA8cHJlPjxjb2RlIHBhcmVudE5hbWU9XCJwcmVcIiB7Li4ue1xuICAgICAgICBcImNsYXNzTmFtZVwiOiBcImxhbmd1YWdlLXRzXCJcbiAgICAgIH19PntgY29uc3QgZm9ybVN0b3JlID0gY3JlYXRlU3RvcmUoKVxuY29uc3QgZW1haWxTdG9yZSA9IGNyZWF0ZVN0b3JlKG51bGwsICcnKVxuY29uc3QgcGFzc3dvcmRTdG9yZSA9IGNyZWF0ZVN0b3JlKG51bGwsICcnKVxuXG5mb3JtU3RvcmUudXNlKHtcbiAgZW1haWw6IGVtYWlsU3RvcmUsXG4gIHBhc3N3b3JkOiBwYXNzd29yZFN0b3JlLFxufSlcblxuZm9ybVN0b3JlLnN1YnNjcmliZSgobmV3U3RhdGUsIG9sZFN0YXRlKSA9PiB7XG4gIGlmIChuZXdTdGF0ZSA9PT0gb2xkU3RhdGUpIHJldHVyblxuXG4gIC8vIHdlJ2xsIGFkZCB0aGlzIGxvZ2ljIG5leHRcbn0pXG5gfTwvY29kZT48L3ByZT5cbiAgICA8YWRtb25pdGlvbiB7Li4ue1xuICAgICAgXCJ0eXBlXCI6IFwidGlwXCJcbiAgICB9fT48cCBwYXJlbnROYW1lPVwiYWRtb25pdGlvblwiPntgVG8gaW1wbGVtZW50IHJlcGxheWFibGUgYWN0aW9ucywgeW91J2QgbmVlZCB0byBhdHRhY2ggYW4gZWZmZWN0cyBzdWJzY3JpYmVyIGluc3RlYWQgdG8gcmVjZWl2ZSBhIG5vdGlmaWNhdGlvbiBmb3IgZXZlcnkgYWN0aW9uLmB9PC9wPjwvYWRtb25pdGlvbj5cbiAgICA8cD57YE5vdyB0aGUgcGFyZW50IG5lZWRzIHRvIHRyYWNrIHN0YXRlIGhpc3Rvcnkgc29tZXdoZXJlLiBXZSdsbCB1c2UgYW5vdGhlciBzdG9yZSBmb3IgdGhpcy5gfTwvcD5cbiAgICA8cHJlPjxjb2RlIHBhcmVudE5hbWU9XCJwcmVcIiB7Li4ue1xuICAgICAgICBcImNsYXNzTmFtZVwiOiBcImxhbmd1YWdlLXRzXCJcbiAgICAgIH19PntgLy8gaGlnaGxpZ2h0LXN0YXJ0XG5jb25zdCBoaXN0b3J5U3RvcmUgPSBjcmVhdGVTdG9yZShudWxsLCB7XG4gIGhpc3Rvcnk6IFtmb3JtU3RvcmUuZ2V0U3RhdGUoKV0sIC8vIHN0YXJ0IHdpdGggdGhlIGN1cnJlbnQgc3RhdGVcbn0pXG4vLyBoaWdobGlnaHQtZW5kXG5cbmZvcm1TdG9yZS5zdWJzY3JpYmUoKG5ld1N0YXRlLCBvbGRTdGF0ZSkgPT4ge1xuICBpZiAobmV3U3RhdGUgPT09IG9sZFN0YXRlKSByZXR1cm5cblxuICAvLyBoaWdobGlnaHQtc3RhcnRcbiAgaGlzdG9yeVN0b3JlLnNldFN0YXRlKCh7IGhpc3RvcnkgfSkgPT4gKHtcbiAgICBoaXN0b3J5OiBbLi4uaGlzdG9yeSwgbmV3U3RhdGVdLFxuICB9KSlcbiAgLy8gaGlnaGxpZ2h0LWVuZFxufSlcbmB9PC9jb2RlPjwvcHJlPlxuICAgIDxwPntgV2l0aCBoaXN0b3J5IHRyYWNrZWQsIHdlIG5lZWQgdGhlIGFiaWxpdHkgdG8gXCJwb2ludFwiIHRvIGEgZGlmZmVyZW50IHN0YXRlIGluIHRoZSBoaXN0b3J5LiBUaGlzIGxldHMgdXMga2VlcCB0cmFjayBvZiB3aGVyZSB3ZSd2ZSB0aW1lIHRyYXZlbGVkIHRvLiBEZWZhdWx0IHRoaXMgdG8gcG9pbnRpbmcgYXQgdGhlIGxhc3QgaGlzdG9yeSBzdGF0ZS5gfTwvcD5cbiAgICA8cHJlPjxjb2RlIHBhcmVudE5hbWU9XCJwcmVcIiB7Li4ue1xuICAgICAgICBcImNsYXNzTmFtZVwiOiBcImxhbmd1YWdlLXRzXCJcbiAgICAgIH19PntgY29uc3QgaGlzdG9yeVN0b3JlID0gY3JlYXRlU3RvcmUobnVsbCwge1xuICBoaXN0b3J5OiBbZm9ybVN0b3JlLmdldFN0YXRlKCldLFxuICAvLyBoaWdobGlnaHQtbmV4dC1saW5lXG4gIHBvaW50ZXI6IDAsXG59KVxuXG5mb3JtU3RvcmUuc3Vic2NyaWJlKChuZXdTdGF0ZSwgb2xkU3RhdGUpID0+IHtcbiAgaWYgKG5ld1N0YXRlID09PSBvbGRTdGF0ZSkgcmV0dXJuXG5cbiAgaGlzdG9yeVN0b3JlLnNldFN0YXRlKCh7IGhpc3RvcnksIHBvaW50ZXIgfSkgPT4gKHtcbiAgICBoaXN0b3J5OiBbLi4uaGlzdG9yeSwgbmV3U3RhdGVdLFxuICAgIC8vIGhpZ2hsaWdodC1uZXh0LWxpbmVcbiAgICBwb2ludGVyOiBwb2ludGVyICsgMSxcbiAgfSkpXG59KVxuYH08L2NvZGU+PC9wcmU+XG4gICAgPHA+e2BOb3cgdG8gaW1wbGVtZW50IHVuZG8vcmVkbzpgfTwvcD5cbiAgICA8cHJlPjxjb2RlIHBhcmVudE5hbWU9XCJwcmVcIiB7Li4ue1xuICAgICAgICBcImNsYXNzTmFtZVwiOiBcImxhbmd1YWdlLXRzXCJcbiAgICAgIH19PntgY29uc3QgdW5kbyA9ICgpID0+IHtcbiAgY29uc3QgbmV3U3RhdGUgPSBoaXN0b3J5U3RvcmUuc2V0U3RhdGVEZWVwKCh7IHBvaW50ZXIgfSkgPT4gKHtcbiAgICBwb2ludGVyOiBNYXRoLm1heCgwLCBwb2ludGVyIC0gMSksXG4gIH0pKVxuXG4gIGZvcm1TdG9yZS5zZXRTdGF0ZShuZXdTdGF0ZS5oaXN0b3J5W25ld1N0YXRlLnBvaW50ZXJdKVxufVxuXG5jb25zdCByZWRvID0gKCkgPT4ge1xuICBjb25zdCBuZXdTdGF0ZSA9IGhpc3RvcnlTdG9yZS5zZXRTdGF0ZURlZXAoKHsgaGlzdG9yeSwgcG9pbnRlciB9KSA9PiAoe1xuICAgIHBvaW50ZXI6IE1hdGgubWluKGhpc3RvcnkubGVuZ3RoIC0gMSwgcG9pbnRlciArIDEpLFxuICB9KSlcblxuICBmb3JtU3RvcmUuc2V0U3RhdGUobmV3U3RhdGUuaGlzdG9yeVtuZXdTdGF0ZS5wb2ludGVyXSlcbn1cbmB9PC9jb2RlPjwvcHJlPlxuICAgIDxwPntgV2UgdXNlIGB9PGlubGluZUNvZGUgcGFyZW50TmFtZT1cInBcIj57YE1hdGgubWluYH08L2lubGluZUNvZGU+e2AgYW5kIGB9PGlubGluZUNvZGUgcGFyZW50TmFtZT1cInBcIj57YE1hdGgubWF4YH08L2lubGluZUNvZGU+e2AgdG8gY2xhbXAgdGhlIHBvaW50ZXIgdG8gdGhlIGhpc3RvcnkgbGVuZ3RoLmB9PC9wPlxuICAgIDxwPntgQnV0IG5vdyB0aGVyZSdzIGEgcHJvYmxlbS4gU2V0dGluZyB0aGUgYH08aW5saW5lQ29kZSBwYXJlbnROYW1lPVwicFwiPntgZm9ybVN0b3JlYH08L2lubGluZUNvZGU+e2BzIHN0YXRlIGxpa2UgdGhpcyB3aWxsIHRyaWdnZXIgdGhlIHN1YnNjcmliZXIsIHB1c2hpbmcgdGhlIHN0YXRlIG9udG8gdGhlIGhpc3RvcnkgYWdhaW4hIFdoZW4gd2UgY2FsbCBgfTxpbmxpbmVDb2RlIHBhcmVudE5hbWU9XCJwXCI+e2B1bmRvYH08L2lubGluZUNvZGU+e2AvYH08aW5saW5lQ29kZSBwYXJlbnROYW1lPVwicFwiPntgcmVkb2B9PC9pbmxpbmVDb2RlPntgLCB3ZSBuZWVkIHRvIHByZXZlbnQgdGhlIHN1YnNjcmliZXIgZnJvbSBydW5uaW5nLmB9PC9wPlxuICAgIDxwPntgVGhlcmUgYXJlIHNldmVyYWwgd2F5cyB0byBhY2NvbXBsaXNoIHRoYXQuIFdlJ2xsIGRvIHRoaXM6YH08L3A+XG4gICAgPHByZT48Y29kZSBwYXJlbnROYW1lPVwicHJlXCIgey4uLntcbiAgICAgICAgXCJjbGFzc05hbWVcIjogXCJsYW5ndWFnZS10c1wiXG4gICAgICB9fT57YGZvcm1TdG9yZS5zdWJzY3JpYmUoKG5ld1N0YXRlLCBvbGRTdGF0ZSkgPT4ge1xuICBpZiAobmV3U3RhdGUgPT09IG9sZFN0YXRlKSByZXR1cm5cblxuICAvLyBoaWdobGlnaHQtc3RhcnRcbiAgY29uc3QgeyBoaXN0b3J5LCBwb2ludGVyIH0gPSBoaXN0b3J5U3RvcmUuZ2V0U3RhdGUoKVxuICBpZiAobmV3U3RhdGUgPT09IGhpc3RvcnlbcG9pbnRlcl0pIHJldHVyblxuICAvLyBoaWdobGlnaHQtZW5kXG5cbiAgaGlzdG9yeVN0b3JlLnNldFN0YXRlKCh7IGhpc3RvcnksIHBvaW50ZXIgfSkgPT4gKHtcbiAgICBoaXN0b3J5OiBbLi4uaGlzdG9yeSwgbmV3U3RhdGVdLFxuICAgIHBvaW50ZXI6IHBvaW50ZXIgKyAxLFxuICB9KSlcbn0pXG5gfTwvY29kZT48L3ByZT5cbiAgICA8cD57YElmIHRoZSBjdXJyZW50IHN0YXRlIGV4YWN0bHkgbWF0Y2hlcyB0aGUgc3RhdGUgdGhlIGhpc3RvcnkgaXMgcG9pbnRpbmcgYXQsIHdlIGtub3cgdGhlIGN1cnJlbnQgc3RhdGUgaXMgYSBoaXN0b3J5IHN0YXRlLiBXZSBkb24ndCBuZWVkIHRvIHRyYWNrIGl0LmB9PC9wPlxuICAgIDxwPntgQWxtb3N0IHRoZXJlISBXZSBqdXN0IG5lZWQgdG8gZml4IG9uZSBsaXR0bGUgdGhpbmcuIElmIHRoZSB1c2VyIGNoYW5nZXMgdGhlIGZvcm0ncyBzdGF0ZSB3aGlsZSB3ZSdyZSBzaG93aW5nIGEgaGlzdG9yeSBzdGF0ZSwgd2UgbmVlZCB0byBlcmFzZSB0aGUgaGlzdG9yeSBhZnRlciB0aGUgcG9pbnRlciBhbmQgc3RhcnQgdHJhY2tpbmcgaGlzdG9yeSBhbmV3IHN0YXJ0aW5nIGZyb20gdGhlIHBvaW50ZXIncyBsb2NhdGlvbi5gfTwvcD5cbiAgICA8cHJlPjxjb2RlIHBhcmVudE5hbWU9XCJwcmVcIiB7Li4ue1xuICAgICAgICBcImNsYXNzTmFtZVwiOiBcImxhbmd1YWdlLXRzXCJcbiAgICAgIH19PntgZm9ybVN0b3JlLnN1YnNjcmliZSgobmV3U3RhdGUsIG9sZFN0YXRlKSA9PiB7XG4gIGlmIChuZXdTdGF0ZSA9PT0gb2xkU3RhdGUpIHJldHVyblxuXG4gIGNvbnN0IHsgaGlzdG9yeSwgcG9pbnRlciB9ID0gaGlzdG9yeVN0b3JlLmdldFN0YXRlKClcbiAgaWYgKG5ld1N0YXRlID09PSBoaXN0b3J5W3BvaW50ZXJdKSByZXR1cm5cblxuICBoaXN0b3J5U3RvcmUuc2V0U3RhdGUoKHsgaGlzdG9yeSwgcG9pbnRlciB9KSA9PiAoe1xuICAgIC8vIGhpZ2hsaWdodC1uZXh0LWxpbmVcbiAgICBoaXN0b3J5OiBbLi4uaGlzdG9yeS5zbGljZSgwLCBwb2ludGVyICsgMSksIG5ld1N0YXRlXSxcbiAgICBwb2ludGVyOiBwb2ludGVyICsgMSxcbiAgfSkpXG59KVxuYH08L2NvZGU+PC9wcmU+XG4gICAgPHA+e2BBbHJpZ2h0ISBXZSdyZSByZWFkeSB0byBwdXQgaXQgYWxsIHRvZ2V0aGVyLiBIZXJlJ3MgdGhlIGZ1bGwgZXhhbXBsZSB3cmFwcGVkIGluIGEgc2ltcGxlIGB9PGlubGluZUNvZGUgcGFyZW50TmFtZT1cInBcIj57YGZvcm1gfTwvaW5saW5lQ29kZT57YCBhdG9tOmB9PC9wPlxuICAgIDxwcmU+PGNvZGUgcGFyZW50TmFtZT1cInByZVwiIHsuLi57XG4gICAgICAgIFwiY2xhc3NOYW1lXCI6IFwibGFuZ3VhZ2UtdHN4XCIsXG4gICAgICAgIFwibWV0YXN0cmluZ1wiOiBcImxpdmUgZWNvc3lzdGVtSWQ9dGltZS10cmF2ZWwvc3RvcmUtdHJhdmVsZXIgcmVzdWx0VmFyPUFwcFwiLFxuICAgICAgICBcImxpdmVcIjogdHJ1ZSxcbiAgICAgICAgXCJlY29zeXN0ZW1JZFwiOiBcInRpbWUtdHJhdmVsL3N0b3JlLXRyYXZlbGVyXCIsXG4gICAgICAgIFwicmVzdWx0VmFyXCI6IFwiQXBwXCJcbiAgICAgIH19PntgY29uc3QgZm9ybUF0b20gPSBhdG9tKCdmb3JtJywgKCkgPT4ge1xuICBjb25zdCBmb3JtU3RvcmUgPSBpbmplY3RTdG9yZSgpXG4gIGNvbnN0IGVtYWlsU3RvcmUgPSBpbmplY3RTdG9yZSgnJywgeyBzdWJzY3JpYmU6IGZhbHNlIH0pIC8vIGRvbid0IG5lZWQgdG8gc3Vic2NyaWJlIHRvIGNoaWxkIHN0b3Jlc1xuICBjb25zdCBwYXNzd29yZFN0b3JlID0gaW5qZWN0U3RvcmUoJycsIHsgc3Vic2NyaWJlOiBmYWxzZSB9KSAvLyBkb24ndCBuZWVkIHRvIHN1YnNjcmliZSB0byBjaGlsZCBzdG9yZXNcblxuICBmb3JtU3RvcmUudXNlKHtcbiAgICBlbWFpbDogZW1haWxTdG9yZSxcbiAgICBwYXNzd29yZDogcGFzc3dvcmRTdG9yZSxcbiAgfSlcblxuICBjb25zdCBoaXN0b3J5U3RvcmUgPSBpbmplY3RTdG9yZSh7XG4gICAgaGlzdG9yeTogW2Zvcm1TdG9yZS5nZXRTdGF0ZSgpXSxcbiAgICBwb2ludGVyOiAwLFxuICB9KVxuXG4gIGluamVjdEVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gZm9ybVN0b3JlLnN1YnNjcmliZSgobmV3U3RhdGUsIG9sZFN0YXRlKSA9PiB7XG4gICAgICBpZiAobmV3U3RhdGUgPT09IG9sZFN0YXRlKSByZXR1cm5cblxuICAgICAgY29uc3QgeyBoaXN0b3J5LCBwb2ludGVyIH0gPSBoaXN0b3J5U3RvcmUuZ2V0U3RhdGUoKVxuICAgICAgaWYgKG5ld1N0YXRlID09PSBoaXN0b3J5W3BvaW50ZXJdKSByZXR1cm5cblxuICAgICAgaGlzdG9yeVN0b3JlLnNldFN0YXRlKCh7IGhpc3RvcnksIHBvaW50ZXIgfSkgPT4gKHtcbiAgICAgICAgaGlzdG9yeTogWy4uLmhpc3Rvcnkuc2xpY2UoMCwgcG9pbnRlciArIDEpLCBuZXdTdGF0ZV0sXG4gICAgICAgIHBvaW50ZXI6IHBvaW50ZXIgKyAxLFxuICAgICAgfSkpXG4gICAgfSlcblxuICAgIHJldHVybiAoKSA9PiBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKVxuICB9LCBbXSlcblxuICBjb25zdCByZWRvID0gKCkgPT4ge1xuICAgIGNvbnN0IG5ld1N0YXRlID0gaGlzdG9yeVN0b3JlLnNldFN0YXRlRGVlcCgoeyBoaXN0b3J5LCBwb2ludGVyIH0pID0+ICh7XG4gICAgICBwb2ludGVyOiBNYXRoLm1pbihoaXN0b3J5Lmxlbmd0aCAtIDEsIHBvaW50ZXIgKyAxKSxcbiAgICB9KSlcblxuICAgIGZvcm1TdG9yZS5zZXRTdGF0ZShuZXdTdGF0ZS5oaXN0b3J5W25ld1N0YXRlLnBvaW50ZXJdKVxuICB9XG5cbiAgY29uc3Qgc2V0RW1haWwgPSBlbWFpbCA9PiBlbWFpbFN0b3JlLnNldFN0YXRlKGVtYWlsKVxuICBjb25zdCBzZXRQYXNzd29yZCA9IHBhc3N3b3JkID0+IHBhc3N3b3JkU3RvcmUuc2V0U3RhdGUocGFzc3dvcmQpXG5cbiAgY29uc3QgdW5kbyA9ICgpID0+IHtcbiAgICBjb25zdCBuZXdTdGF0ZSA9IGhpc3RvcnlTdG9yZS5zZXRTdGF0ZURlZXAoKHsgcG9pbnRlciB9KSA9PiAoe1xuICAgICAgcG9pbnRlcjogTWF0aC5tYXgoMCwgcG9pbnRlciAtIDEpLFxuICAgIH0pKVxuXG4gICAgZm9ybVN0b3JlLnNldFN0YXRlKG5ld1N0YXRlLmhpc3RvcnlbbmV3U3RhdGUucG9pbnRlcl0pXG4gIH1cblxuICByZXR1cm4gYXBpKGZvcm1TdG9yZSkuc2V0RXhwb3J0cyh7XG4gICAgcmVkbyxcbiAgICBzZXRFbWFpbCxcbiAgICBzZXRQYXNzd29yZCxcbiAgICB1bmRvLFxuICB9KVxufSlcblxuZnVuY3Rpb24gRGV2dG9vbHMoKSB7XG4gIGNvbnN0IHsgcmVkbywgdW5kbyB9ID0gdXNlQXRvbUluc3RhbmNlKGZvcm1BdG9tKS5leHBvcnRzXG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2PlxuICAgICAgPGJ1dHRvbiBvbkNsaWNrPXt1bmRvfT5VbmRvPC9idXR0b24+XG4gICAgICA8YnV0dG9uIG9uQ2xpY2s9e3JlZG99PlJlZG88L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG5mdW5jdGlvbiBMb2dpbkZvcm0oKSB7XG4gIGNvbnN0IFt7IGVtYWlsLCBwYXNzd29yZCB9LCB7IHNldEVtYWlsLCBzZXRQYXNzd29yZCB9XSA9IHVzZUF0b21TdGF0ZShcbiAgICBmb3JtQXRvbVxuICApXG5cbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAgPGRpdj5cbiAgICAgICAgRW1haWw6eycgJ31cbiAgICAgICAgPGlucHV0IG9uQ2hhbmdlPXtldmVudCA9PiBzZXRFbWFpbChldmVudC50YXJnZXQudmFsdWUpfSB2YWx1ZT17ZW1haWx9IC8+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXY+XG4gICAgICAgIFBhc3N3b3JkOnsnICd9XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIG9uQ2hhbmdlPXtldmVudCA9PiBzZXRQYXNzd29yZChldmVudC50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHZhbHVlPXtwYXNzd29yZH1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgIDwvPlxuICApXG59XG5cbmZ1bmN0aW9uIEFwcCgpIHtcbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAgPERldnRvb2xzIC8+XG4gICAgICA8TG9naW5Gb3JtIC8+XG4gICAgPC8+XG4gIClcbn1cbmB9PC9jb2RlPjwvcHJlPlxuICAgIDxoMiB7Li4ue1xuICAgICAgXCJpZFwiOiBcImF0b20tdHJhdmVsZXJcIlxuICAgIH19PntgQXRvbSBUcmF2ZWxlcmB9PC9oMj5cbiAgICA8cD57YFNpbmNlIGFuIGF0b20gaGFzIGV4YWN0bHkgb25lIGV4cG9zZWQgc3RvcmUsIHVuZG8vcmVkbyBpcyB2ZXJ5IHNpbWlsYXIgd2l0aCBhdG9tcy4gSW4gZmFjdCwgeW91IGNhbiBzaW1wbHkgZXh0cmFjdCB0aGUgYWJvdmUgdGltZSB0cmF2ZWwgbG9naWMgdG8gYSBjdXN0b20gaW5qZWN0b3IgYW5kIHJldXNlIHRoYXQgaW4gZXZlcnkgYXRvbSB3aGVyZSB5b3Ugd2FudCB0aW1lIHRyYXZlbC4gRm9yIGV4YW1wbGU6YH08L3A+XG4gICAgPHByZT48Y29kZSBwYXJlbnROYW1lPVwicHJlXCIgey4uLntcbiAgICAgICAgXCJjbGFzc05hbWVcIjogXCJsYW5ndWFnZS10c1wiXG4gICAgICB9fT57YGNvbnN0IGluamVjdFRpbWVUcmF2ZWwgPSBzdG9yZSA9PiB7XG4gIGNvbnN0IGhpc3RvcnlTdG9yZSA9IGluamVjdFN0b3JlKHtcbiAgICBoaXN0b3J5OiBbZm9ybVN0b3JlLmdldFN0YXRlKCldLFxuICAgIHBvaW50ZXI6IDAsXG4gIH0pXG5cbiAgaW5qZWN0RWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBzdWJzY3JpcHRpb24gPSBmb3JtU3RvcmUuc3Vic2NyaWJlKChuZXdTdGF0ZSwgb2xkU3RhdGUpID0+IHtcbiAgICAgIGlmIChuZXdTdGF0ZSA9PT0gb2xkU3RhdGUpIHJldHVyblxuXG4gICAgICBjb25zdCB7IGhpc3RvcnksIHBvaW50ZXIgfSA9IGhpc3RvcnlTdG9yZS5nZXRTdGF0ZSgpXG4gICAgICBpZiAobmV3U3RhdGUgPT09IGhpc3RvcnlbcG9pbnRlcl0pIHJldHVyblxuXG4gICAgICBoaXN0b3J5U3RvcmUuc2V0U3RhdGUoKHsgaGlzdG9yeSwgcG9pbnRlciB9KSA9PiAoe1xuICAgICAgICBoaXN0b3J5OiBbLi4uaGlzdG9yeS5zbGljZSgwLCBwb2ludGVyICsgMSksIG5ld1N0YXRlXSxcbiAgICAgICAgcG9pbnRlcjogcG9pbnRlciArIDEsXG4gICAgICB9KSlcbiAgICB9KVxuXG4gICAgcmV0dXJuICgpID0+IHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpXG4gIH0sIFtdKVxuXG4gIGNvbnN0IHJlZG8gPSAoKSA9PiB7XG4gICAgY29uc3QgbmV3U3RhdGUgPSBoaXN0b3J5U3RvcmUuc2V0U3RhdGVEZWVwKCh7IGhpc3RvcnksIHBvaW50ZXIgfSkgPT4gKHtcbiAgICAgIHBvaW50ZXI6IE1hdGgubWluKGhpc3RvcnkubGVuZ3RoIC0gMSwgcG9pbnRlciArIDEpLFxuICAgIH0pKVxuXG4gICAgc3RvcmUuc2V0U3RhdGUobmV3U3RhdGUuaGlzdG9yeVtuZXdTdGF0ZS5wb2ludGVyXSlcbiAgfVxuXG4gIGNvbnN0IHVuZG8gPSAoKSA9PiB7XG4gICAgY29uc3QgbmV3U3RhdGUgPSBoaXN0b3J5U3RvcmUuc2V0U3RhdGVEZWVwKCh7IHBvaW50ZXIgfSkgPT4gKHtcbiAgICAgIHBvaW50ZXI6IE1hdGgubWF4KDAsIHBvaW50ZXIgLSAxKSxcbiAgICB9KSlcblxuICAgIHN0b3JlLnNldFN0YXRlKG5ld1N0YXRlLmhpc3RvcnlbbmV3U3RhdGUucG9pbnRlcl0pXG4gIH1cblxuICByZXR1cm4gYXBpKGhpc3RvcnlTdG9yZSkuc2V0RXhwb3J0cyh7IHJlZG8sIHVuZG8gfSlcbn1cbmB9PC9jb2RlPjwvcHJlPlxuICAgIDxwPntgRXhhbXBsZSB1c2FnZTpgfTwvcD5cbiAgICA8cHJlPjxjb2RlIHBhcmVudE5hbWU9XCJwcmVcIiB7Li4ue1xuICAgICAgICBcImNsYXNzTmFtZVwiOiBcImxhbmd1YWdlLXRzXCJcbiAgICAgIH19PntgY29uc3QgZm9ybUF0b20gPSBhdG9tKCdmb3JtJywgKCkgPT4ge1xuICBjb25zdCBmb3JtU3RvcmUgPSBpbmplY3RTdG9yZSgpXG4gIGNvbnN0IGVtYWlsU3RvcmUgPSBpbmplY3RTdG9yZSgnJywgeyBzdWJzY3JpYmU6IGZhbHNlIH0pXG4gIGNvbnN0IHBhc3N3b3JkU3RvcmUgPSBpbmplY3RTdG9yZSgnJywgeyBzdWJzY3JpYmU6IGZhbHNlIH0pXG5cbiAgZm9ybVN0b3JlLnVzZSh7XG4gICAgZW1haWw6IGVtYWlsU3RvcmUsXG4gICAgcGFzc3dvcmQ6IHBhc3N3b3JkU3RvcmUsXG4gIH0pXG5cbiAgLy8gaGlnaGxpZ2h0LW5leHQtbGluZVxuICBjb25zdCBoaXN0b3J5QXBpID0gaW5qZWN0VGltZVRyYXZlbChmb3JtU3RvcmUpXG5cbiAgY29uc3Qgc2V0RW1haWwgPSBlbWFpbCA9PiBlbWFpbFN0b3JlLnNldFN0YXRlKGVtYWlsKVxuICBjb25zdCBzZXRQYXNzd29yZCA9IHBhc3N3b3JkID0+IHBhc3N3b3JkU3RvcmUuc2V0U3RhdGUocGFzc3dvcmQpXG5cbiAgcmV0dXJuIGFwaShmb3JtU3RvcmUpLnNldEV4cG9ydHMoe1xuICAgIC8vIGhpZ2hsaWdodC1uZXh0LWxpbmVcbiAgICAuLi5oaXN0b3J5QXBpLmV4cG9ydHMsXG4gICAgc2V0RW1haWwsXG4gICAgc2V0UGFzc3dvcmQsXG4gIH0pXG59KVxuYH08L2NvZGU+PC9wcmU+XG4gICAgPHA+e2BUaGlzIGFwcHJvYWNoIGlzIGZpbmUgaWYgaXQgd29ya3MgZm9yIHlvdSwgYnV0IGEgdGhlb3JldGljYWwgZG93bnNpZGUgaXMgdGhhdCBzdGF0ZSBtYW5hZ2VtZW50IGFuZCB0aW1lIHRyYXZlbCBhcmUgb3J0aG9nb25hbCBjb25jZXJucy4gVGlnaHRseSBjb3VwbGluZyBhbiBhdG9tIHRvIGl0cyB0aW1lIHRyYXZlbCBpbXBsZW1lbnRhdGlvbiBpcyAuLi4gd2VpcmQuIEl0IHNob3VsZCBmZWVsIHVubmF0dXJhbCBiZWNhdXNlIGl0IGlzLmB9PC9wPlxuICAgIDxwPntgU2luY2Ugd2Uga25vdyB3ZSdyZSB3b3JraW5nIHdpdGggYW4gYXRvbSwgd2UgY2FuIHVwZ3JhZGUgdGhpcyBzZXR1cCBhIGxpdHRsZS5gfTwvcD5cbiAgICA8cD57YFJlbWVtYmVyIHRoYXQgYXRvbXMgY2FuIHRha2Ugb3RoZXIgYXRvbSBpbnN0YW5jZXMgYXMgcGFyYW1zLiBXZSBjYW4gdXNlIHRoaXMgcG93ZXIgdG8gY3JlYXRlIGEgYH08aW5saW5lQ29kZSBwYXJlbnROYW1lPVwicFwiPntgdGltZVRyYXZlbEF0b21gfTwvaW5saW5lQ29kZT57YCB0aGF0IGFjY2VwdHMgYW55IGF0b20gaW5zdGFuY2UgYW5kIHRhY2tzIHRpbWUgdHJhdmVsIG9udG8gaXQuYH08L3A+XG4gICAgPHByZT48Y29kZSBwYXJlbnROYW1lPVwicHJlXCIgey4uLntcbiAgICAgICAgXCJjbGFzc05hbWVcIjogXCJsYW5ndWFnZS10c1wiXG4gICAgICB9fT57YGNvbnN0IHRpbWVUcmF2ZWxBdG9tID0gaW9uKCd0aW1lVHJhdmVsJywgKHsgZ2V0IH0sIGluc3RhbmNlKSA9PiB7XG4gIGNvbnN0IGluc3RhbmNlU3RhdGUgPSBnZXQoaW5zdGFuY2UpXG4gIGNvbnN0IHN0b3JlID0gaW5qZWN0U3RvcmUoe1xuICAgIGhpc3Rvcnk6IFtpbnN0YW5jZVN0YXRlXSxcbiAgICBwb2ludGVyOiAwLFxuICB9KVxuICBjb25zdCB7IGhpc3RvcnksIHBvaW50ZXIgfSA9IHN0b3JlLmdldFN0YXRlKClcblxuICAvLyBpZiB0aGUgc3RhdGUgY2hhbmdlZCwgYWRkIGl0IHRvIHRoZSBoaXN0b3J5XG4gIGlmIChpbnN0YW5jZVN0YXRlICE9PSBoaXN0b3J5W3BvaW50ZXJdKSB7XG4gICAgc3RvcmUuc2V0U3RhdGVEZWVwKCh7IGhpc3RvcnksIHBvaW50ZXIgfSkgPT4gKHtcbiAgICAgIGhpc3Rvcnk6IFsuLi5oaXN0b3J5LnNsaWNlKDAsIHBvaW50ZXIgKyAxKSwgaW5zdGFuY2VTdGF0ZV0sXG4gICAgICBwb2ludGVyOiBwb2ludGVyICsgMSxcbiAgICB9KSlcbiAgfVxuXG4gIGNvbnN0IHJlZG8gPSAoKSA9PiB7XG4gICAgY29uc3QgbmV3U3RhdGUgPSBzdG9yZS5zZXRTdGF0ZURlZXAoKHsgaGlzdG9yeSwgcG9pbnRlciB9KSA9PiAoe1xuICAgICAgcG9pbnRlcjogTWF0aC5taW4oaGlzdG9yeS5sZW5ndGggLSAxLCBwb2ludGVyICsgMSksXG4gICAgfSkpXG5cbiAgICBpbnN0YW5jZS5zZXRTdGF0ZShuZXdTdGF0ZS5oaXN0b3J5W25ld1N0YXRlLnBvaW50ZXJdKVxuICB9XG5cbiAgY29uc3QgdW5kbyA9ICgpID0+IHtcbiAgICBjb25zdCBuZXdTdGF0ZSA9IHN0b3JlLnNldFN0YXRlRGVlcCgoeyBwb2ludGVyIH0pID0+ICh7XG4gICAgICBwb2ludGVyOiBNYXRoLm1heCgwLCBwb2ludGVyIC0gMSksXG4gICAgfSkpXG5cbiAgICBpbnN0YW5jZS5zZXRTdGF0ZShuZXdTdGF0ZS5oaXN0b3J5W25ld1N0YXRlLnBvaW50ZXJdKVxuICB9XG5cbiAgcmV0dXJuIGFwaShzdG9yZSkuc2V0RXhwb3J0cyh7IHJlZG8sIHVuZG8gfSlcbn0pXG5gfTwvY29kZT48L3ByZT5cbiAgICA8cD57YEV4YW1wbGUgdXNhZ2U6YH08L3A+XG4gICAgPHByZT48Y29kZSBwYXJlbnROYW1lPVwicHJlXCIgey4uLntcbiAgICAgICAgXCJjbGFzc05hbWVcIjogXCJsYW5ndWFnZS10c3hcIlxuICAgICAgfX0+e2BmdW5jdGlvbiBEZXZ0b29scygpIHtcbiAgY29uc3QgaW5zdGFuY2UgPSB1c2VBdG9tSW5zdGFuY2UoZm9ybUF0b20pXG4gIGNvbnN0IFtzdGF0ZUhpc3RvcnksIHsgcmVkbywgdW5kbyB9XSA9IHVzZUF0b21TdGF0ZSh0aW1lVHJhdmVsQXRvbSwgW1xuICAgIGluc3RhbmNlLFxuICBdKVxuXG4gIHJldHVybiAoXG4gICAgPGRpdj5cbiAgICAgIDxidXR0b24gb25DbGljaz17dW5kb30+VW5kbzwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBvbkNsaWNrPXtyZWRvfT5SZWRvPC9idXR0b24+XG4gICAgPC9kaXY+XG4gIClcbn1cbmB9PC9jb2RlPjwvcHJlPlxuICAgIDxwPntgVGhlIHByaW1hcnkgYWR2YW50YWdlIG9mIHRoaXMgYXBwcm9hY2ggb3ZlciB0aGUgY3VzdG9tIGluamVjdG9yIGFwcHJvYWNoIGlzIHRoYXQgdGltZSB0cmF2ZWwgaXMgbm93IGEgY29tcGxldGVseSBzZXBhcmF0ZSBjb25jZXJuLiBBbnkgYXRvbSBjYW4gYmUgbWFkZSB0aW1lLXRyYXZlbGFibGUsIGFuZCBubyBhdG9tIGhhcyB0byBrbm93IHdoZXRoZXIgaXQgaXMuYH08L3A+XG4gICAgPHA+e2BGdWxsIGxpdmUgZXhhbXBsZTpgfTwvcD5cbiAgICA8cHJlPjxjb2RlIHBhcmVudE5hbWU9XCJwcmVcIiB7Li4ue1xuICAgICAgICBcImNsYXNzTmFtZVwiOiBcImxhbmd1YWdlLXRzeFwiLFxuICAgICAgICBcIm1ldGFzdHJpbmdcIjogXCJsaXZlIGVjb3N5c3RlbUlkPXRpbWUtdHJhdmVsL2F0b20tdHJhdmVsZXIgcmVzdWx0VmFyPUFwcFwiLFxuICAgICAgICBcImxpdmVcIjogdHJ1ZSxcbiAgICAgICAgXCJlY29zeXN0ZW1JZFwiOiBcInRpbWUtdHJhdmVsL2F0b20tdHJhdmVsZXJcIixcbiAgICAgICAgXCJyZXN1bHRWYXJcIjogXCJBcHBcIlxuICAgICAgfX0+e2Bjb25zdCB0ZXh0QXRvbSA9IGF0b20oJ3RleHQnLCAoaWQ6IHN0cmluZykgPT4gJycpXG5cbmNvbnN0IGZvcm1BdG9tID0gYXRvbSgnZm9ybScsICgpID0+IHtcbiAgY29uc3Qgc3RvcmUgPSBpbmplY3RTdG9yZSgpXG4gIGNvbnN0IGVtYWlsSW5zdGFuY2UgPSBpbmplY3RBdG9tSW5zdGFuY2UodGV4dEF0b20sIFsnZW1haWwnXSlcbiAgY29uc3QgcGFzc3dvcmRJbnN0YW5jZSA9IGluamVjdEF0b21JbnN0YW5jZSh0ZXh0QXRvbSwgWydwYXNzd29yZCddKVxuXG4gIHN0b3JlLnVzZSh7XG4gICAgZW1haWw6IGVtYWlsSW5zdGFuY2Uuc3RvcmUsXG4gICAgcGFzc3dvcmQ6IHBhc3N3b3JkSW5zdGFuY2Uuc3RvcmUsXG4gIH0pXG5cbiAgcmV0dXJuIGFwaShzdG9yZSkuc2V0RXhwb3J0cyh7XG4gICAgc2V0RW1haWw6IGVtYWlsID0+IHN0b3JlLnNldFN0YXRlRGVlcCh7IGVtYWlsIH0pLFxuICAgIHNldFBhc3N3b3JkOiBwYXNzd29yZCA9PiBzdG9yZS5zZXRTdGF0ZURlZXAoeyBwYXNzd29yZCB9KSxcbiAgfSlcbn0pXG5cbmNvbnN0IHRpbWVUcmF2ZWxBdG9tID0gaW9uKCd0aW1lVHJhdmVsJywgKHsgZ2V0IH0sIGluc3RhbmNlKSA9PiB7XG4gIGNvbnN0IGluc3RhbmNlU3RhdGUgPSBnZXQoaW5zdGFuY2UpXG4gIGNvbnN0IHN0b3JlID0gaW5qZWN0U3RvcmUoe1xuICAgIGhpc3Rvcnk6IFtpbnN0YW5jZVN0YXRlXSxcbiAgICBwb2ludGVyOiAwLFxuICB9KVxuICBjb25zdCB7IGhpc3RvcnksIHBvaW50ZXIgfSA9IHN0b3JlLmdldFN0YXRlKClcblxuICAvLyBpZiB0aGUgc3RhdGUgY2hhbmdlZCwgYWRkIGl0IHRvIHRoZSBoaXN0b3J5XG4gIGlmIChpbnN0YW5jZVN0YXRlICE9PSBoaXN0b3J5W3BvaW50ZXJdKSB7XG4gICAgc3RvcmUuc2V0U3RhdGVEZWVwKCh7IGhpc3RvcnksIHBvaW50ZXIgfSkgPT4gKHtcbiAgICAgIGhpc3Rvcnk6IFsuLi5oaXN0b3J5LnNsaWNlKDAsIHBvaW50ZXIgKyAxKSwgaW5zdGFuY2VTdGF0ZV0sXG4gICAgICBwb2ludGVyOiBwb2ludGVyICsgMSxcbiAgICB9KSlcbiAgfVxuXG4gIGNvbnN0IHJlZG8gPSAoKSA9PiB7XG4gICAgY29uc3QgbmV3U3RhdGUgPSBzdG9yZS5zZXRTdGF0ZURlZXAoKHsgaGlzdG9yeSwgcG9pbnRlciB9KSA9PiAoe1xuICAgICAgcG9pbnRlcjogTWF0aC5taW4oaGlzdG9yeS5sZW5ndGggLSAxLCBwb2ludGVyICsgMSksXG4gICAgfSkpXG5cbiAgICBpbnN0YW5jZS5zZXRTdGF0ZShuZXdTdGF0ZS5oaXN0b3J5W25ld1N0YXRlLnBvaW50ZXJdKVxuICB9XG5cbiAgY29uc3QgdW5kbyA9ICgpID0+IHtcbiAgICBjb25zdCBuZXdTdGF0ZSA9IHN0b3JlLnNldFN0YXRlRGVlcCgoeyBwb2ludGVyIH0pID0+ICh7XG4gICAgICBwb2ludGVyOiBNYXRoLm1heCgwLCBwb2ludGVyIC0gMSksXG4gICAgfSkpXG5cbiAgICBpbnN0YW5jZS5zZXRTdGF0ZShuZXdTdGF0ZS5oaXN0b3J5W25ld1N0YXRlLnBvaW50ZXJdKVxuICB9XG5cbiAgcmV0dXJuIGFwaShzdG9yZSkuc2V0RXhwb3J0cyh7IHJlZG8sIHVuZG8gfSlcbn0pXG5cbmZ1bmN0aW9uIERldnRvb2xzKCkge1xuICBjb25zdCBpbnN0YW5jZSA9IHVzZUF0b21JbnN0YW5jZShmb3JtQXRvbSlcbiAgY29uc3QgeyByZWRvLCB1bmRvIH0gPSB1c2VBdG9tSW5zdGFuY2UodGltZVRyYXZlbEF0b20sIFtpbnN0YW5jZV0pLmV4cG9ydHNcblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8YnV0dG9uIG9uQ2xpY2s9e3VuZG99PlVuZG88L2J1dHRvbj5cbiAgICAgIDxidXR0b24gb25DbGljaz17cmVkb30+UmVkbzwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICApXG59XG5cbmZ1bmN0aW9uIExvZ2luRm9ybSgpIHtcbiAgY29uc3QgW3sgZW1haWwsIHBhc3N3b3JkIH0sIHsgc2V0RW1haWwsIHNldFBhc3N3b3JkIH1dID0gdXNlQXRvbVN0YXRlKFxuICAgIGZvcm1BdG9tXG4gIClcblxuICByZXR1cm4gKFxuICAgIDw+XG4gICAgICA8ZGl2PlxuICAgICAgICBFbWFpbDp7JyAnfVxuICAgICAgICA8aW5wdXQgb25DaGFuZ2U9e2V2ZW50ID0+IHNldEVtYWlsKGV2ZW50LnRhcmdldC52YWx1ZSl9IHZhbHVlPXtlbWFpbH0gLz5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdj5cbiAgICAgICAgUGFzc3dvcmQ6eycgJ31cbiAgICAgICAgPGlucHV0XG4gICAgICAgICAgb25DaGFuZ2U9e2V2ZW50ID0+IHNldFBhc3N3b3JkKGV2ZW50LnRhcmdldC52YWx1ZSl9XG4gICAgICAgICAgdmFsdWU9e3Bhc3N3b3JkfVxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG4gICAgPC8+XG4gIClcbn1cblxuZnVuY3Rpb24gQXBwKCkge1xuICByZXR1cm4gKFxuICAgIDw+XG4gICAgICA8RGV2dG9vbHMgLz5cbiAgICAgIDxMb2dpbkZvcm0gLz5cbiAgICA8Lz5cbiAgKVxufVxuYH08L2NvZGU+PC9wcmU+XG4gICAgPGgyIHsuLi57XG4gICAgICBcImlkXCI6IFwiZWNvc3lzdGVtLXRyYXZlbGVyXCJcbiAgICB9fT57YEVjb3N5c3RlbSBUcmF2ZWxlcmB9PC9oMj5cbiAgICA8YWRtb25pdGlvbiB7Li4ue1xuICAgICAgXCJ0eXBlXCI6IFwidGlwXCJcbiAgICB9fT48cCBwYXJlbnROYW1lPVwiYWRtb25pdGlvblwiPntgVGhpcyBzZWN0aW9uIGFzc3VtZXMgYmFzaWMga25vd2xlZGdlIG9mIGB9PGEgcGFyZW50TmFtZT1cInBcIiB7Li4ue1xuICAgICAgICAgIFwiaHJlZlwiOiBcInBsdWdpbnNcIlxuICAgICAgICB9fT57YHBsdWdpbnNgfTwvYT57YC4gSXQncyByZWNvbW1lbmRlZCB0byByZWFkIHRoYXQgZ3VpZGUgZmlyc3QuYH08L3A+PC9hZG1vbml0aW9uPlxuICAgIDxwPntgQWxyaWdodCwgd2UncmUgaW4gYSBjb21wbGV0ZWx5IGRpZmZlcmVudCB3b3JsZCBub3cuIFRyYWNraW5nIGFuZCByZXN0b3JpbmcgZXZlcnkgc3RhdGUgY2hhbmdlIGluIHRoZSBlbnRpcmUgYXBwbGljYXRpb24gaXMgYSBiaWcgdGFzayBhbmQgY2FuIG9ubHkgYmUgYWNjb21wbGlzaGVkIHdpdGggcGx1Z2lucy5gfTwvcD5cbiAgICA8cD57YFRvIHRyYWNrIHN0YXRlIGNoYW5nZXMsIGEgcGx1Z2luIG5lZWRzIHRvIHR1cm4gb24gdGhlIGB9PGEgcGFyZW50TmFtZT1cInBcIiB7Li4ue1xuICAgICAgICBcImhyZWZcIjogXCIuLi9hcGkvY2xhc3Nlcy9aZWR1eFBsdWdpbiNzdGF0ZWNoYW5nZWRcIlxuICAgICAgfX0+PGlubGluZUNvZGUgcGFyZW50TmFtZT1cImFcIj57YHN0YXRlQ2hhbmdlZGB9PC9pbmxpbmVDb2RlPntgIG1vZGB9PC9hPntgLmB9PC9wPlxuICAgIDxwcmU+PGNvZGUgcGFyZW50TmFtZT1cInByZVwiIHsuLi57XG4gICAgICAgIFwiY2xhc3NOYW1lXCI6IFwibGFuZ3VhZ2UtdHNcIlxuICAgICAgfX0+e2BpbXBvcnQgeyBaZWR1eFBsdWdpbiB9IGZyb20gJ0B6ZWR1eC9yZWFjdCdcblxuY29uc3QgdGltZVRyYXZlbFBsdWdpbiA9IG5ldyBaZWR1eFBsdWdpbih7XG4gIGluaXRpYWxNb2RzOiBbJ3N0YXRlQ2hhbmdlZCddLFxuXG4gIHJlZ2lzdGVyRWNvc3lzdGVtOiBlY29zeXN0ZW0gPT4ge1xuICAgIC8vIHdlJ2xsIGFkZCB0aGlzIGxvZ2ljIG5leHRcbiAgfSxcbn0pXG5gfTwvY29kZT48L3ByZT5cbiAgICA8cD57YE5vdyB5b3UgbmVlZCB0byB0cmFjayBoaXN0b3J5IHN0YXRlLiBUaGlzIGlzIGFsbW9zdCB0aGUgc2FtZSBhcyB0cmFja2luZyBoaXN0b3J5IHN0YXRlIGZvciBhIHNpbmdsZSBhdG9tLCBidXQgd2l0aCBhIHNlcGFyYXRlIGVudHJ5IGZvciBldmVyeSBhdG9tLmB9PC9wPlxuICAgIDxwPntgQSBzaW1wbGUgd2F5IHRvIGdldCBhbiBvYmplY3QgbWFwcGluZyBhdG9tIGluc3RhbmNlIGlkcyB0byB0aGVpciB2YWx1ZXMgaXMgdG8gdXNlIGB9PGEgcGFyZW50TmFtZT1cInBcIiB7Li4ue1xuICAgICAgICBcImhyZWZcIjogXCIuLi9hcGkvY2xhc3Nlcy9FY29zeXN0ZW0jZGVoeWRyYXRlXCJcbiAgICAgIH19PjxpbmxpbmVDb2RlIHBhcmVudE5hbWU9XCJhXCI+e2BlY29zeXN0ZW0uZGVoeWRyYXRlKClgfTwvaW5saW5lQ29kZT48L2E+e2A6YH08L3A+XG4gICAgPHByZT48Y29kZSBwYXJlbnROYW1lPVwicHJlXCIgey4uLntcbiAgICAgICAgXCJjbGFzc05hbWVcIjogXCJsYW5ndWFnZS10c1wiXG4gICAgICB9fT57YGNvbnN0IHRpbWVUcmF2ZWxQbHVnaW4gPSBuZXcgWmVkdXhQbHVnaW4oe1xuICBpbml0aWFsTW9kczogWydzdGF0ZUNoYW5nZWQnXSxcblxuICByZWdpc3RlckVjb3N5c3RlbTogZWNvc3lzdGVtID0+IHtcbiAgICAvLyBoaWdobGlnaHQtc3RhcnRcbiAgICBjb25zdCBzdGF0ZSA9IHtcbiAgICAgIGhpc3Rvcnk6IFtlY29zeXN0ZW0uZGVoeWRyYXRlKHsgZXhjbHVkZUZsYWdzOiBbJ25vLXRpbWUtdHJhdmVsJ10gfSldLFxuICAgICAgcG9pbnRlcjogMCxcbiAgICB9XG4gICAgLy8gaGlnaGxpZ2h0LWVuZFxuICB9LFxufSlcbmB9PC9jb2RlPjwvcHJlPlxuICAgIDxwPntgTm93IGFkZCBhIHNpbXBsZSBzdWJzY3JpcHRpb24gb24gdGhlIGVjb3N5c3RlbSdzIGB9PGEgcGFyZW50TmFtZT1cInBcIiB7Li4ue1xuICAgICAgICBcImhyZWZcIjogXCIuLi9hcGkvY2xhc3Nlcy9FY29zeXN0ZW0jbW9kYnVzXCJcbiAgICAgIH19PjxpbmxpbmVDb2RlIHBhcmVudE5hbWU9XCJhXCI+e2Btb2RCdXNgfTwvaW5saW5lQ29kZT48L2E+e2AgdGhhdCBmaWx0ZXJzIG91dCBldmVyeXRoaW5nIGJ1dCBgfTxpbmxpbmVDb2RlIHBhcmVudE5hbWU9XCJwXCI+e2BzdGF0ZUNoYW5nZWRgfTwvaW5saW5lQ29kZT57YCBtb2QgZXZlbnRzLmB9PC9wPlxuICAgIDxwPntgU2luY2UgYXRvbSBzZWxlY3RvcnMgYWxzbyB0cmlnZ2VyIGB9PGlubGluZUNvZGUgcGFyZW50TmFtZT1cInBcIj57YHN0YXRlQ2hhbmdlZGB9PC9pbmxpbmVDb2RlPntgIG1vZCBldmVudHMsIGZpbHRlciBvdXQgYW55IGV2ZW50cyB0aGF0IGRvbid0IGhhdmUgYSBgfTxpbmxpbmVDb2RlIHBhcmVudE5hbWU9XCJwXCI+e2AuaW5zdGFuY2VgfTwvaW5saW5lQ29kZT57YCBwcm9wZXJ0eSB0b28uIFRpbWUgdHJhdmVsIG9ubHkgZGVhbHMgd2l0aCB0b3AtbGV2ZWwgc3RhdGUuIFN0YXRlIGRlcml2YXRpb25zIGxpa2Ugc2VsZWN0b3JzIHNob3VsZG4ndCBiZSB0cmFja2VkLmB9PC9wPlxuICAgIDxwcmU+PGNvZGUgcGFyZW50TmFtZT1cInByZVwiIHsuLi57XG4gICAgICAgIFwiY2xhc3NOYW1lXCI6IFwibGFuZ3VhZ2UtdHNcIlxuICAgICAgfX0+e2Bjb25zdCB0aW1lVHJhdmVsUGx1Z2luID0gbmV3IFplZHV4UGx1Z2luKHtcbiAgaW5pdGlhbE1vZHM6IFsnc3RhdGVDaGFuZ2VkJ10sXG5cbiAgcmVnaXN0ZXJFY29zeXN0ZW06IGVjb3N5c3RlbSA9PiB7XG4gICAgY29uc3Qgc3RhdGUgPSB7XG4gICAgICBoaXN0b3J5OiBbZWNvc3lzdGVtLmRlaHlkcmF0ZSh7IGV4Y2x1ZGVGbGFnczogWyduby10aW1lLXRyYXZlbCddIH0pXSxcbiAgICAgIHBvaW50ZXI6IDAsXG4gICAgfVxuXG4gICAgLy8gaGlnaGxpZ2h0LXN0YXJ0XG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gZWNvc3lzdGVtLm1vZEJ1cy5zdWJzY3JpYmUoe1xuICAgICAgZWZmZWN0czogKHsgYWN0aW9uIH0pID0+IHtcbiAgICAgICAgLy8gb25seSBoYW5kbGUgc3RhdGVDaGFuZ2VkIG1vZCBldmVudHMgZm9yIGF0b20gaW5zdGFuY2VzXG4gICAgICAgIGlmIChcbiAgICAgICAgICBhY3Rpb24udHlwZSA9PT0gWmVkdXhQbHVnaW4uYWN0aW9ucy5zdGF0ZUNoYW5nZWQudHlwZSAmJlxuICAgICAgICAgIGFjdGlvbi5wYXlsb2FkPy5pbnN0YW5jZVxuICAgICAgICApIHtcbiAgICAgICAgICBzdGF0ZS5oaXN0b3J5ID0gW1xuICAgICAgICAgICAgLi4uc3RhdGUuaGlzdG9yeS5zbGljZSgwLCBzdGF0ZS5wb2ludGVyICsgMSksXG4gICAgICAgICAgICBlY29zeXN0ZW0uZGVoeWRyYXRlKHsgZXhjbHVkZUZsYWdzOiBbJ25vLXRpbWUtdHJhdmVsJ10gfSksXG4gICAgICAgICAgXVxuICAgICAgICAgIHN0YXRlLnBvaW50ZXIgKz0gMVxuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pXG4gICAgLy8gaGlnaGxpZ2h0LWVuZFxuXG4gICAgcmV0dXJuICgpID0+IHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpXG4gIH0sXG59KVxuYH08L2NvZGU+PC9wcmU+XG4gICAgPHA+e2BOb3cgd2UgbmVlZCB0byBhY3R1YWxseSBoYW5kbGUgdW5kby9yZWRvLiBXZSdsbCB1c2UgdGhlIGB9PGEgcGFyZW50TmFtZT1cInBcIiB7Li4ue1xuICAgICAgICBcImhyZWZcIjogXCJwbHVnaW5zI3ZpYS1tb2RidXNcIlxuICAgICAgfX0+PGlubGluZUNvZGUgcGFyZW50TmFtZT1cImFcIj57YG1vZEJ1c2B9PC9pbmxpbmVDb2RlPntgIHRvIHNlbmQgYWN0aW9uc2B9PC9hPntgIHRvIHRoZSBwbHVnaW4uIFRoZSBwbHVnaW4gY2FuIHVzZSBpdHMgZXhpc3RpbmcgYH08aW5saW5lQ29kZSBwYXJlbnROYW1lPVwicFwiPntgbW9kQnVzYH08L2lubGluZUNvZGU+e2Agc3Vic2NyaXB0aW9uIHRvIGxpc3RlbiBmb3IgYH08aW5saW5lQ29kZSBwYXJlbnROYW1lPVwicFwiPntgdW5kb2B9PC9pbmxpbmVDb2RlPntgIGFuZCBgfTxpbmxpbmVDb2RlIHBhcmVudE5hbWU9XCJwXCI+e2ByZWRvYH08L2lubGluZUNvZGU+e2AgZXZlbnRzOmB9PC9wPlxuICAgIDxwcmU+PGNvZGUgcGFyZW50TmFtZT1cInByZVwiIHsuLi57XG4gICAgICAgIFwiY2xhc3NOYW1lXCI6IFwibGFuZ3VhZ2UtdHNcIlxuICAgICAgfX0+e2AvLyBoaWdobGlnaHQtc3RhcnRcbmNvbnN0IHVuZG8gPSBhY3Rpb25GYWN0b3J5KCdAQHRpbWVUcmF2ZWwvdW5kbycpXG5jb25zdCByZWRvID0gYWN0aW9uRmFjdG9yeSgnQEB0aW1lVHJhdmVsL3JlZG8nKVxuLy8gaGlnaGxpZ2h0LWVuZFxuXG5jb25zdCB0aW1lVHJhdmVsUGx1Z2luID0gbmV3IFplZHV4UGx1Z2luKHtcbiAgaW5pdGlhbE1vZHM6IFsnc3RhdGVDaGFuZ2VkJ10sXG5cbiAgcmVnaXN0ZXJFY29zeXN0ZW06IGVjb3N5c3RlbSA9PiB7XG4gICAgY29uc3Qgc3RhdGUgPSB7XG4gICAgICBoaXN0b3J5OiBbZWNvc3lzdGVtLmRlaHlkcmF0ZSh7IGV4Y2x1ZGVGbGFnczogWyduby10aW1lLXRyYXZlbCddIH0pXSxcbiAgICAgIC8vIGhpZ2hsaWdodC1uZXh0LWxpbmVcbiAgICAgIGlzSHlkcmF0aW5nOiBmYWxzZSxcbiAgICAgIHBvaW50ZXI6IDAsXG4gICAgfVxuXG4gICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gZWNvc3lzdGVtLm1vZEJ1cy5zdWJzY3JpYmUoe1xuICAgICAgZWZmZWN0czogKHsgYWN0aW9uIH0pID0+IHtcbiAgICAgICAgLy8gb25seSB0cmFjayBoaXN0b3J5IGlmIHdlJ3JlIG5vdCBjdXJyZW50bHkgdGltZSB0cmF2ZWxpbmdcbiAgICAgICAgLy8gaGlnaGxpZ2h0LW5leHQtbGluZVxuICAgICAgICBpZiAoc3RhdGUuaXNIeWRyYXRpbmcpIHJldHVyblxuXG4gICAgICAgIC8vIG9ubHkgaGFuZGxlIHN0YXRlQ2hhbmdlZCBtb2QgZXZlbnRzIGZvciBhdG9tIGluc3RhbmNlc1xuICAgICAgICBpZiAoXG4gICAgICAgICAgYWN0aW9uLnR5cGUgPT09IFplZHV4UGx1Z2luLmFjdGlvbnMuc3RhdGVDaGFuZ2VkLnR5cGUgJiZcbiAgICAgICAgICBhY3Rpb24ucGF5bG9hZD8uaW5zdGFuY2VcbiAgICAgICAgKSB7XG4gICAgICAgICAgc3RhdGUuaGlzdG9yeSA9IFtcbiAgICAgICAgICAgIC4uLnN0YXRlLmhpc3Rvcnkuc2xpY2UoMCwgc3RhdGUucG9pbnRlciArIDEpLFxuICAgICAgICAgICAgZWNvc3lzdGVtLmRlaHlkcmF0ZSh7IGV4Y2x1ZGVGbGFnczogWyduby10aW1lLXRyYXZlbCddIH0pLFxuICAgICAgICAgIF1cbiAgICAgICAgICBzdGF0ZS5wb2ludGVyICs9IDFcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGhpZ2hsaWdodC1zdGFydFxuICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT09IHVuZG8udHlwZSkge1xuICAgICAgICAgIGNvbnN0IHsgcG9pbnRlciB9ID0gc3RhdGVcbiAgICAgICAgICBjb25zdCBuZXdQb2ludGVyID0gTWF0aC5tYXgoMCwgcG9pbnRlciAtIDEpXG5cbiAgICAgICAgICBpZiAobmV3UG9pbnRlciA9PT0gcG9pbnRlcikgcmV0dXJuXG5cbiAgICAgICAgICBzdGF0ZS5wb2ludGVyID0gbmV3UG9pbnRlclxuICAgICAgICAgIHN0YXRlLmlzSHlkcmF0aW5nID0gdHJ1ZVxuICAgICAgICAgIGVjb3N5c3RlbS5oeWRyYXRlKHN0YXRlLmhpc3RvcnlbbmV3UG9pbnRlcl0pXG4gICAgICAgICAgc3RhdGUuaXNIeWRyYXRpbmcgPSBmYWxzZVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFjdGlvbi50eXBlID09PSByZWRvLnR5cGUpIHtcbiAgICAgICAgICBjb25zdCB7IGhpc3RvcnksIHBvaW50ZXIgfSA9IHN0YXRlXG4gICAgICAgICAgY29uc3QgbmV3UG9pbnRlciA9IE1hdGgubWluKGhpc3RvcnkubGVuZ3RoIC0gMSwgcG9pbnRlciArIDEpXG5cbiAgICAgICAgICBpZiAobmV3UG9pbnRlciA9PT0gcG9pbnRlcikgcmV0dXJuXG5cbiAgICAgICAgICBzdGF0ZS5wb2ludGVyID0gbmV3UG9pbnRlclxuICAgICAgICAgIHN0YXRlLmlzSHlkcmF0aW5nID0gdHJ1ZVxuICAgICAgICAgIGVjb3N5c3RlbS5oeWRyYXRlKHN0YXRlLmhpc3RvcnlbbmV3UG9pbnRlcl0pXG4gICAgICAgICAgc3RhdGUuaXNIeWRyYXRpbmcgPSBmYWxzZVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIC8vIGhpZ2hsaWdodC1lbmRcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIHJldHVybiAoKSA9PiBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKVxuICB9LFxufSlcbmB9PC9jb2RlPjwvcHJlPlxuICAgIDxwPntgVGhlcmUncyBvbmUgbGFzdCB0aGluZyB0byBmaXguIFNpbmNlIGB9PGlubGluZUNvZGUgcGFyZW50TmFtZT1cInBcIj57YHJlZ2lzdGVyRWNvc3lzdGVtYH08L2lubGluZUNvZGU+e2AgaXMgY2FsbGVkIGFzIHNvb24gYXMgdGhlIHBsdWdpbiBpcyByZWdpc3RlcmVkLCBvdXIgaW5pdGlhbCBzdGF0ZSBzbmFwc2hvdCB3aWxsIGJlIGVtcHR5LiBUaGUgZWNvc3lzdGVtIGRvZXNuJ3Qga25vdyB3aGF0IGF0b21zIGFyZSBnb2luZyB0byBleGlzdCBpbnNpZGUgaXQsIHNvIHRoZSBkZWh5ZHJhdGlvbiBpcyBhIGNvbXBsZXRlbHkgZW1wdHkgb2JqZWN0LmB9PC9wPlxuICAgIDxwPntgVGhpcyBtZWFucyB0aGF0IHRoZSBoeWRyYXRpb24gd29uJ3QgYWZmZWN0IGFueSBhdG9tcy4gVGhlcmUgYXJlIHNldmVyYWwgd2F5cyB0byBmaXggdGhpcy5gfTwvcD5cbiAgICA8cD57YE9uZSBhcHByb2FjaCBpcyB0byBtYWtlIHRoZSBwbHVnaW4gaG9vayBpbnRvIGB9PGlubGluZUNvZGUgcGFyZW50TmFtZT1cInBcIj57YHN0YXR1c0NoYW5nZWRgfTwvaW5saW5lQ29kZT57YCBldmVudHMgYW5kIHdhbGsgYmFjayB0aHJvdWdoIHRoZSBzdGF0ZSBoaXN0b3J5LCB1cGRhdGluZyBldmVyeSBzbmFwc2hvdCB0byBpbmNsdWRlIHRoZSBuZXcgYXRvbSdzIGluaXRpYWwgc3RhdGUgd2hlbiBhIG5ldyBhdG9tJ3MgYH08aW5saW5lQ29kZSBwYXJlbnROYW1lPVwicFwiPntgc3RhdHVzYH08L2lubGluZUNvZGU+e2AgY2hhbmdlcyBmcm9tIEluaXRpYWxpemluZyB0byBBY3RpdmUuYH08L3A+XG4gICAgPHA+e2BCdXQgZm9yIHNpbXBsaWNpdHkgaW4gdGhpcyBleGFtcGxlLCB3ZSdyZSBqdXN0IGdvbm5hIHNldCB0aGUgaW5pdGlhbCBoaXN0b3J5IHRoZSBmaXJzdCB0aW1lIHdlIHNlZSBhbnkgc3RhdGUgY2hhbmdlLCBpbnN0ZWFkIG9mIHNldHRpbmcgaXQgYXMgc29vbiBhcyB0aGUgcGx1Z2luIGlzIHJlZ2lzdGVyZWQgaW4gdGhlIGVjb3N5c3RlbS5gfTwvcD5cbiAgICA8cHJlPjxjb2RlIHBhcmVudE5hbWU9XCJwcmVcIiB7Li4ue1xuICAgICAgICBcImNsYXNzTmFtZVwiOiBcImxhbmd1YWdlLXRzXCJcbiAgICAgIH19PntgY29uc3QgdGltZVRyYXZlbFBsdWdpbiA9IG5ldyBaZWR1eFBsdWdpbih7XG4gIGluaXRpYWxNb2RzOiBbJ3N0YXRlQ2hhbmdlZCddLFxuXG4gIHJlZ2lzdGVyRWNvc3lzdGVtOiBlY29zeXN0ZW0gPT4ge1xuICAgIGNvbnN0IHN0YXRlID0ge1xuICAgICAgLy8gaGlnaGxpZ2h0LW5leHQtbGluZVxuICAgICAgaGlzdG9yeTogW10sXG4gICAgICBpc0h5ZHJhdGluZzogZmFsc2UsXG4gICAgICBwb2ludGVyOiAwLFxuICAgIH1cblxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGVjb3N5c3RlbS5tb2RCdXMuc3Vic2NyaWJlKHtcbiAgICAgIGVmZmVjdHM6ICh7IGFjdGlvbiB9KSA9PiB7XG4gICAgICAgIC8vIG9ubHkgdHJhY2sgaGlzdG9yeSBpZiB3ZSdyZSBub3QgY3VycmVudGx5IHRpbWUgdHJhdmVsaW5nXG4gICAgICAgIGlmIChzdGF0ZS5pc0h5ZHJhdGluZykgcmV0dXJuXG5cbiAgICAgICAgLy8gb25seSBoYW5kbGUgc3RhdGVDaGFuZ2VkIG1vZCBldmVudHMgZm9yIGF0b20gaW5zdGFuY2VzXG4gICAgICAgIGlmIChcbiAgICAgICAgICBhY3Rpb24udHlwZSA9PT0gWmVkdXhQbHVnaW4uYWN0aW9ucy5zdGF0ZUNoYW5nZWQudHlwZSAmJlxuICAgICAgICAgIGFjdGlvbi5wYXlsb2FkPy5pbnN0YW5jZVxuICAgICAgICApIHtcbiAgICAgICAgICAvLyBnZXQgaW5pdGlhbCBzbmFwc2hvdCBub3dcbiAgICAgICAgICAvLyBoaWdobGlnaHQtc3RhcnRcbiAgICAgICAgICBpZiAoIXN0YXRlLmhpc3RvcnkubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGVjb3N5c3RlbS5kZWh5ZHJhdGUoe1xuICAgICAgICAgICAgICBleGNsdWRlRmxhZ3M6IFsnbm8tdGltZS10cmF2ZWwnXSxcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHNuYXBzaG90W2FjdGlvbi5wYXlsb2FkLmluc3RhbmNlLmlkXSA9IGFjdGlvbi5wYXlsb2FkLm9sZFN0YXRlXG4gICAgICAgICAgICBzdGF0ZS5oaXN0b3J5LnB1c2goc25hcHNob3QpXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGhpZ2hsaWdodC1lbmRcblxuICAgICAgICAgIHN0YXRlLmhpc3RvcnkgPSBbXG4gICAgICAgICAgICAuLi5zdGF0ZS5oaXN0b3J5LnNsaWNlKDAsIHN0YXRlLnBvaW50ZXIgKyAxKSxcbiAgICAgICAgICAgIGVjb3N5c3RlbS5kZWh5ZHJhdGUoeyBleGNsdWRlRmxhZ3M6IFsnbm8tdGltZS10cmF2ZWwnXSB9KSxcbiAgICAgICAgICBdXG4gICAgICAgICAgc3RhdGUucG9pbnRlciArPSAxXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT09IHVuZG8udHlwZSkge1xuICAgICAgICAgIGNvbnN0IHsgcG9pbnRlciB9ID0gc3RhdGVcbiAgICAgICAgICBjb25zdCBuZXdQb2ludGVyID0gTWF0aC5tYXgoMCwgcG9pbnRlciAtIDEpXG5cbiAgICAgICAgICBpZiAobmV3UG9pbnRlciA9PT0gcG9pbnRlcikgcmV0dXJuXG5cbiAgICAgICAgICBzdGF0ZS5wb2ludGVyID0gbmV3UG9pbnRlclxuICAgICAgICAgIHN0YXRlLmlzSHlkcmF0aW5nID0gdHJ1ZVxuICAgICAgICAgIGVjb3N5c3RlbS5oeWRyYXRlKHN0YXRlLmhpc3RvcnlbbmV3UG9pbnRlcl0pXG4gICAgICAgICAgc3RhdGUuaXNIeWRyYXRpbmcgPSBmYWxzZVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFjdGlvbi50eXBlID09PSByZWRvLnR5cGUpIHtcbiAgICAgICAgICBjb25zdCB7IGhpc3RvcnksIHBvaW50ZXIgfSA9IHN0YXRlXG4gICAgICAgICAgY29uc3QgbmV3UG9pbnRlciA9IE1hdGgubWluKGhpc3RvcnkubGVuZ3RoIC0gMSwgcG9pbnRlciArIDEpXG5cbiAgICAgICAgICBpZiAobmV3UG9pbnRlciA9PT0gcG9pbnRlcikgcmV0dXJuXG5cbiAgICAgICAgICBzdGF0ZS5wb2ludGVyID0gbmV3UG9pbnRlclxuICAgICAgICAgIHN0YXRlLmlzSHlkcmF0aW5nID0gdHJ1ZVxuICAgICAgICAgIGVjb3N5c3RlbS5oeWRyYXRlKHN0YXRlLmhpc3RvcnlbbmV3UG9pbnRlcl0pXG4gICAgICAgICAgc3RhdGUuaXNIeWRyYXRpbmcgPSBmYWxzZVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pXG5cbiAgICByZXR1cm4gKCkgPT4gc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKClcbiAgfSxcbn0pXG5gfTwvY29kZT48L3ByZT5cbiAgICA8cD57YEFuZCBmaW5hbGx5LCBhbGwgdG9nZXRoZXI6YH08L3A+XG4gICAgPHByZT48Y29kZSBwYXJlbnROYW1lPVwicHJlXCIgey4uLntcbiAgICAgICAgXCJjbGFzc05hbWVcIjogXCJsYW5ndWFnZS10c3hcIixcbiAgICAgICAgXCJtZXRhc3RyaW5nXCI6IFwibGl2ZSBlY29zeXN0ZW1JZD1lY29zeXN0ZW0tdGltZS10cmF2ZWwgbm9Qcm92aWRlIHJlc3VsdFZhcj1BcHBcIixcbiAgICAgICAgXCJsaXZlXCI6IHRydWUsXG4gICAgICAgIFwiZWNvc3lzdGVtSWRcIjogXCJlY29zeXN0ZW0tdGltZS10cmF2ZWxcIixcbiAgICAgICAgXCJub1Byb3ZpZGVcIjogdHJ1ZSxcbiAgICAgICAgXCJyZXN1bHRWYXJcIjogXCJBcHBcIlxuICAgICAgfX0+e2Bjb25zdCB1bmRvID0gYWN0aW9uRmFjdG9yeSgnQEB0aW1lVHJhdmVsL3VuZG8nKVxuY29uc3QgcmVkbyA9IGFjdGlvbkZhY3RvcnkoJ0BAdGltZVRyYXZlbC9yZWRvJylcblxuY29uc3QgdGltZVRyYXZlbFBsdWdpbiA9IG5ldyBaZWR1eFBsdWdpbih7XG4gIGluaXRpYWxNb2RzOiBbJ3N0YXRlQ2hhbmdlZCddLFxuXG4gIHJlZ2lzdGVyRWNvc3lzdGVtOiBlY29zeXN0ZW0gPT4ge1xuICAgIGNvbnN0IHN0YXRlID0ge1xuICAgICAgaGlzdG9yeTogW10sXG4gICAgICBpc0h5ZHJhdGluZzogZmFsc2UsXG4gICAgICBwb2ludGVyOiAwLFxuICAgIH1cblxuICAgIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGVjb3N5c3RlbS5tb2RCdXMuc3Vic2NyaWJlKHtcbiAgICAgIGVmZmVjdHM6ICh7IGFjdGlvbiB9KSA9PiB7XG4gICAgICAgIC8vIG9ubHkgdHJhY2sgaGlzdG9yeSBpZiB3ZSdyZSBub3QgY3VycmVudGx5IHRpbWUgdHJhdmVsaW5nXG4gICAgICAgIGlmIChzdGF0ZS5pc0h5ZHJhdGluZykgcmV0dXJuXG5cbiAgICAgICAgLy8gb25seSBoYW5kbGUgc3RhdGVDaGFuZ2VkIG1vZCBldmVudHMgZm9yIGF0b20gaW5zdGFuY2VzXG4gICAgICAgIGlmIChcbiAgICAgICAgICBhY3Rpb24udHlwZSA9PT0gWmVkdXhQbHVnaW4uYWN0aW9ucy5zdGF0ZUNoYW5nZWQudHlwZSAmJlxuICAgICAgICAgIGFjdGlvbi5wYXlsb2FkPy5pbnN0YW5jZVxuICAgICAgICApIHtcbiAgICAgICAgICAvLyBnZXQgaW5pdGlhbCBzbmFwc2hvdCBub3dcbiAgICAgICAgICBpZiAoIXN0YXRlLmhpc3RvcnkubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCBzbmFwc2hvdCA9IGVjb3N5c3RlbS5kZWh5ZHJhdGUoe1xuICAgICAgICAgICAgICBleGNsdWRlRmxhZ3M6IFsnbm8tdGltZS10cmF2ZWwnXSxcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHNuYXBzaG90W2FjdGlvbi5wYXlsb2FkLmluc3RhbmNlLmlkXSA9IGFjdGlvbi5wYXlsb2FkLm9sZFN0YXRlXG4gICAgICAgICAgICBzdGF0ZS5oaXN0b3J5LnB1c2goc25hcHNob3QpXG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc3RhdGUuaGlzdG9yeSA9IFtcbiAgICAgICAgICAgIC4uLnN0YXRlLmhpc3Rvcnkuc2xpY2UoMCwgc3RhdGUucG9pbnRlciArIDEpLFxuICAgICAgICAgICAgZWNvc3lzdGVtLmRlaHlkcmF0ZSh7IGV4Y2x1ZGVGbGFnczogWyduby10aW1lLXRyYXZlbCddIH0pLFxuICAgICAgICAgIF1cbiAgICAgICAgICBzdGF0ZS5wb2ludGVyICs9IDFcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhY3Rpb24udHlwZSA9PT0gdW5kby50eXBlKSB7XG4gICAgICAgICAgY29uc3QgeyBwb2ludGVyIH0gPSBzdGF0ZVxuICAgICAgICAgIGNvbnN0IG5ld1BvaW50ZXIgPSBNYXRoLm1heCgwLCBwb2ludGVyIC0gMSlcblxuICAgICAgICAgIGlmIChuZXdQb2ludGVyID09PSBwb2ludGVyKSByZXR1cm5cblxuICAgICAgICAgIHN0YXRlLnBvaW50ZXIgPSBuZXdQb2ludGVyXG4gICAgICAgICAgc3RhdGUuaXNIeWRyYXRpbmcgPSB0cnVlXG4gICAgICAgICAgZWNvc3lzdGVtLmh5ZHJhdGUoc3RhdGUuaGlzdG9yeVtuZXdQb2ludGVyXSlcbiAgICAgICAgICBzdGF0ZS5pc0h5ZHJhdGluZyA9IGZhbHNlXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoYWN0aW9uLnR5cGUgPT09IHJlZG8udHlwZSkge1xuICAgICAgICAgIGNvbnN0IHsgaGlzdG9yeSwgcG9pbnRlciB9ID0gc3RhdGVcbiAgICAgICAgICBjb25zdCBuZXdQb2ludGVyID0gTWF0aC5taW4oaGlzdG9yeS5sZW5ndGggLSAxLCBwb2ludGVyICsgMSlcblxuICAgICAgICAgIGlmIChuZXdQb2ludGVyID09PSBwb2ludGVyKSByZXR1cm5cblxuICAgICAgICAgIHN0YXRlLnBvaW50ZXIgPSBuZXdQb2ludGVyXG4gICAgICAgICAgc3RhdGUuaXNIeWRyYXRpbmcgPSB0cnVlXG4gICAgICAgICAgZWNvc3lzdGVtLmh5ZHJhdGUoc3RhdGUuaGlzdG9yeVtuZXdQb2ludGVyXSlcbiAgICAgICAgICBzdGF0ZS5pc0h5ZHJhdGluZyA9IGZhbHNlXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSlcblxuICAgIHJldHVybiAoKSA9PiBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKVxuICB9LFxufSlcblxuY29uc3QgZm9ybUF0b20gPSBhdG9tKCdmb3JtJywgKCkgPT4ge1xuICBjb25zdCBzdG9yZSA9IGluamVjdFN0b3JlKHtcbiAgICBlbWFpbDogJycsXG4gICAgcGFzc3dvcmQ6ICcnLFxuICB9KVxuXG4gIHJldHVybiBhcGkoc3RvcmUpLnNldEV4cG9ydHMoe1xuICAgIHNldEVtYWlsOiBlbWFpbCA9PiBzdG9yZS5zZXRTdGF0ZURlZXAoeyBlbWFpbCB9KSxcbiAgICBzZXRQYXNzd29yZDogcGFzc3dvcmQgPT4gc3RvcmUuc2V0U3RhdGVEZWVwKHsgcGFzc3dvcmQgfSksXG4gIH0pXG59KVxuXG5mdW5jdGlvbiBEZXZ0b29scygpIHtcbiAgY29uc3QgZWNvc3lzdGVtID0gdXNlRWNvc3lzdGVtKClcblxuICByZXR1cm4gKFxuICAgIDxkaXY+XG4gICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IGVjb3N5c3RlbS5tb2RCdXMuZGlzcGF0Y2godW5kbygpKX0+VW5kbzwvYnV0dG9uPlxuICAgICAgPGJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBlY29zeXN0ZW0ubW9kQnVzLmRpc3BhdGNoKHJlZG8oKSl9PlJlZG88L2J1dHRvbj5cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG5mdW5jdGlvbiBMb2dpbkZvcm0oKSB7XG4gIGNvbnN0IFt7IGVtYWlsLCBwYXNzd29yZCB9LCB7IHNldEVtYWlsLCBzZXRQYXNzd29yZCB9XSA9IHVzZUF0b21TdGF0ZShcbiAgICBmb3JtQXRvbVxuICApXG5cbiAgcmV0dXJuIChcbiAgICA8PlxuICAgICAgPGRpdj5cbiAgICAgICAgRW1haWw6eycgJ31cbiAgICAgICAgPGlucHV0IG9uQ2hhbmdlPXtldmVudCA9PiBzZXRFbWFpbChldmVudC50YXJnZXQudmFsdWUpfSB2YWx1ZT17ZW1haWx9IC8+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXY+XG4gICAgICAgIFBhc3N3b3JkOnsnICd9XG4gICAgICAgIDxpbnB1dFxuICAgICAgICAgIG9uQ2hhbmdlPXtldmVudCA9PiBzZXRQYXNzd29yZChldmVudC50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIHZhbHVlPXtwYXNzd29yZH1cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgIDwvPlxuICApXG59XG5cbmZ1bmN0aW9uIEFwcCgpIHtcbiAgY29uc3QgZWNvc3lzdGVtID0gdXNlTWVtbygoKSA9PiB7XG4gICAgY29uc3QgZWNvc3lzdGVtID0gY3JlYXRlRWNvc3lzdGVtKHsgaWQ6ICdlY29zeXN0ZW0tdGltZS10cmF2ZWwnIH0pXG5cbiAgICBlY29zeXN0ZW0ucmVnaXN0ZXJQbHVnaW4odGltZVRyYXZlbFBsdWdpbilcblxuICAgIHJldHVybiBlY29zeXN0ZW1cbiAgfSwgW10pXG5cbiAgcmV0dXJuIChcbiAgICA8RWNvc3lzdGVtUHJvdmlkZXIgZWNvc3lzdGVtPXtlY29zeXN0ZW19PlxuICAgICAgPERldnRvb2xzIC8+XG4gICAgICA8TG9naW5Gb3JtIC8+XG4gICAgPC9FY29zeXN0ZW1Qcm92aWRlcj5cbiAgKVxufVxuYH08L2NvZGU+PC9wcmU+XG4gICAgPGgyIHsuLi57XG4gICAgICBcImlkXCI6IFwicmVjYXBcIlxuICAgIH19PntgUmVjYXBgfTwvaDI+XG4gICAgPHVsPlxuICAgICAgPGxpIHBhcmVudE5hbWU9XCJ1bFwiPntgVGhlIHBhcmVudCBzdG9yZSBpcyBhIHBvd2VyZnVsIHNpbmdsZSBwb2ludCBvZiBlbnRyeSBmb3Igd29ya2luZyB0aW1lIHRyYXZlbCBtYWdpYy5gfTwvbGk+XG4gICAgICA8bGkgcGFyZW50TmFtZT1cInVsXCI+e2BVc2UgYSBzaW1wbGUgc3Vic2NyaWJlciB0byB0cmFjayBzdG9yZSBzdGF0ZSBoaXN0b3J5IChmb3IgdW5kby9yZWRvKS5gfTwvbGk+XG4gICAgICA8bGkgcGFyZW50TmFtZT1cInVsXCI+e2BVc2UgYW4gZWZmZWN0cyBzdWJzY3JpYmVyIG9yIGFjdGlvbiBzdHJlYW0gdG8gdHJhY2sgYWxsIGFjdGlvbnMgZGlzcGF0Y2hlZCB0byBhIHN0b3JlIChmb3IgcmVwbGF5YWJsZSBhY3Rpb25zKS5gfTwvbGk+XG4gICAgICA8bGkgcGFyZW50TmFtZT1cInVsXCI+e2BEaXNwYXRjaCB0cmFja2VkIGFjdGlvbnMgZGlyZWN0bHkgdG8gdGhlIHBhcmVudCBzdG9yZSB0byByZXBsYXkgdGhlIGFjdGlvbiwgbm8gbWF0dGVyIHdoZXJlIGluIHRoZSBoaWVyYXJjaHkgaXQgb3JpZ2luYWxseSBoYXBwZW5lZC5gfTwvbGk+XG4gICAgICA8bGkgcGFyZW50TmFtZT1cInVsXCI+e2BTZXQgc3RhdGUgZGlyZWN0bHkgb24gdGhlIHBhcmVudCBzdG9yZSB0byB1cGRhdGUgdGhlIHN0YXRlIG9mIGFsbCBvciBzZXZlcmFsIGNoaWxkIHN0b3JlcyBhdCBvbmNlLmB9PC9saT5cbiAgICAgIDxsaSBwYXJlbnROYW1lPVwidWxcIj57YFBhc3NpbmcgYXRvbSBpbnN0YW5jZXMgYXMgcGFyYW1zIGlzIGEgcG93ZXJmdWwgd2F5IHRvIGF0dGFjaCB0aW1lIHRyYXZlbCB0byBhbnkgYXRvbSBpbnN0YW5jZSB3aGlsZSBtYWludGFpbmluZyBzZXBhcmF0aW9uIG9mIGNvbmNlcm5zLmB9PC9saT5cbiAgICAgIDxsaSBwYXJlbnROYW1lPVwidWxcIj57YFVzZSBhIHBsdWdpbiBmb3IgbWF4aW11bSBjb250cm9sLmB9PC9saT5cbiAgICA8L3VsPlxuICAgIDwvTURYTGF5b3V0Pjtcbn1cbjtcbk1EWENvbnRlbnQuaXNNRFhDb21wb25lbnQgPSB0cnVlO1xuIl0sIm5hbWVzIjpbIlJlYWN0IiwibWR4IiwiZnJvbnRNYXR0ZXIiLCJpZCIsInRpdGxlIiwiY29udGVudFRpdGxlIiwidW5kZWZpbmVkIiwibWV0YWRhdGEiLCJhc3NldHMiLCJ0b2MiLCJ2YWx1ZSIsImxldmVsIiwibGF5b3V0UHJvcHMiLCJNRFhMYXlvdXQiLCJNRFhDb250ZW50IiwiY29tcG9uZW50cyIsInByb3BzIiwiaXNNRFhDb21wb25lbnQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///3960\n')}}]);