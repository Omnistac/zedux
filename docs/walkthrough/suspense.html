<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-walkthrough/suspense">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Suspense | Zedux</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://omnistac.github.io/zedux/docs/walkthrough/suspense"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Suspense | Zedux"><meta data-rh="true" name="description" content="Atoms are extremely flexible when working with React suspense. We&#x27;ve learned how to use Atom APIs to set an atom instance&#x27;s promise. It&#x27;s time we learned all about suspense."><meta data-rh="true" property="og:description" content="Atoms are extremely flexible when working with React suspense. We&#x27;ve learned how to use Atom APIs to set an atom instance&#x27;s promise. It&#x27;s time we learned all about suspense."><link data-rh="true" rel="icon" href="/zedux/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://omnistac.github.io/zedux/docs/walkthrough/suspense"><link data-rh="true" rel="alternate" href="https://omnistac.github.io/zedux/docs/walkthrough/suspense" hreflang="en"><link data-rh="true" rel="alternate" href="https://omnistac.github.io/zedux/docs/walkthrough/suspense" hreflang="x-default"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Source+Code+Pro&display=swap">
<script src="https://unpkg.com/typescript@latest/lib/typescriptServices.js"></script><link rel="stylesheet" href="/zedux/assets/css/styles.86e2e91c.css">
<link rel="preload" href="/zedux/assets/js/runtime~main.135d385d.js" as="script">
<link rel="preload" href="/zedux/assets/js/main.e6a207f2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div class="ssc-hide" style="display:contents"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zedux/"><div class="navbar__logo"><img src="/zedux/img/logo.png" alt="Zedux Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/zedux/img/logo.png" alt="Zedux Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zedux/docs/walkthrough/quick-start">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Omnistac/zedux" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zedux/docs/about/introduction">About</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/zedux/docs/walkthrough/quick-start">Walkthrough</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/atom-state">Atom State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/atom-instances">Atom Instances</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/atom-apis">Atom APIs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/ecosystems">Ecosystems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/the-graph">The Graph</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/overrides">Overrides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/configuring-atoms">Configuring Atoms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/atom-getters">Atom Getters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/selectors">Selectors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/destruction">Destruction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/react-context">React Context</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/zedux/docs/walkthrough/suspense">Suspense</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/query-atoms">Query Atoms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/stores">Stores</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/side-effects">Side Effects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/custom-injectors">Custom Injectors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/resets">Resets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/zedux/docs/walkthrough/state-machines">State Machines</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zedux/docs/advanced/complex-params">Advanced</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/zedux/docs/api/classes/Atom">API</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/zedux/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Walkthrough</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Suspense</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Suspense</h1></header><p>Atoms are extremely flexible when working with React suspense. We&#x27;ve learned how to use <a href="/zedux/docs/walkthrough/atom-apis">Atom APIs</a> to set an atom instance&#x27;s promise. It&#x27;s time we learned all about suspense.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>you will learn</div><div class="admonitionContent_S0QG"><ul><li>How to efficiently use atoms as suspending resources in React</li><li>How to &quot;render-as-you-fetch&quot; with atoms</li><li>Best practices for creating and updating promises</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quick-overview">Quick Overview<a class="hash-link" href="#quick-overview" title="Direct link to heading">​</a></h2><p>To quickly review setting promises with an <a href="/zedux/docs/api/classes/AtomApi">AtomApi</a>, let&#x27;s create an example atom that we&#x27;ll use throughout this walkthrough:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> atom </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@zedux/react&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> fetchAtom </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;fetch&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> store </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectStore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">undefined</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> subscribe</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> promise </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fetch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">async</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setState</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>fetchAtom</code> is used in a component (e.g. with <code>useAtomValue</code> or <code>useAtomInstance</code>), Zedux will throw the promise, allowing React to suspend. When the promise completes, React will recreate the component and Zedux will no longer throw the now-resolved promise.</p><p>Using <code>subscribe: false</code> is essential to make this approach work. Without it the promise will make this atom reevaluate every time it completes, which would recreate the promise, making an infinite loop.</p><p>You can access the promise directly on the atom instance via <code>instance.promise</code>. You can use this outside React to wait until an atom instance is &quot;ready&quot;:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> fetchUsersInstance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> myEcosystem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">getInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fetchAtom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;/users&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetchUsersInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// users are loaded!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="changing-the-promise">Changing the Promise<a class="hash-link" href="#changing-the-promise" title="Direct link to heading">​</a></h2><p>If the promise reference changes on a subsequent evaluation, Zedux will make all components using the atom instance suspend again.</p><p>Our <code>fetchAtom</code> above will create a new promise reference every time it evaluates. But with the current implementation, it has no dependencies that could cause it to reevaluate! As we learned in <a href="/zedux/docs/walkthrough/selectors">the selectors walkthrough</a>, Zedux gives you lots of control over when evaluations happen. In this case, we can use <a href="/zedux/docs/api/classes/AtomInstance#invalidate"><code>instance.invalidate()</code></a> to force the atom to reevaluate:</p><div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">RefreshUsers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> instance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useAtomInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fetchAtom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;/users&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)"> </span><span class="token tag script language-javascript arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)"> instance</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token tag script language-javascript method function property-access" style="color:rgb(130, 170, 255)">invalidate</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text">Refresh</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">button</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When this button is clicked, <code>fetchAtom</code> will reevaluate and create a new promise reference, causing all components using it to suspend again. We can prevent a component from suspending with the <code>suspend</code> hook config option:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">RefreshUsers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> instance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useAtomInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fetchAtom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;/users&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">    suspend</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">button onClick</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> instance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">invalidate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain">Refresh</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">button</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here&#x27;s a live sandbox putting this all together:</p><section class="section18 s_zedux_docs_walkthrough_suspense0"><div class="div12 s_zedux_docs_walkthrough_suspense1"><img src="/zedux/img/zedux-icon-75x75.png"><span class="span14 s_zedux_docs_walkthrough_suspense2">Live Sandbox</span><span class="span13 s_zedux_docs_walkthrough_suspense3"><span class="span9 s_zedux_docs_walkthrough_suspense4"><button class="button6 s_zedux_docs_walkthrough_suspense5"><span>Log</span><svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="transparent" stroke="#fff" d="M0 0 L 6 8 L 12 0"></path></svg></button></span><button class="button15 s_zedux_docs_walkthrough_suspense6">Reset</button></span></div><div class="div10 s_zedux_docs_walkthrough_suspense7"><div class="div11 s_zedux_docs_walkthrough_suspense8"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span><span>21</span><span>22</span><span>23</span><span>24</span><span>25</span><span>26</span><span>27</span><span>28</span><span>29</span><span>30</span><span>31</span><span>32</span><span>33</span><span>34</span><span>35</span><span>36</span><span>37</span><span>38</span><span>39</span><span>40</span><span>41</span><span>42</span><span>43</span><span>44</span><span>45</span><span>46</span><span>47</span><span>48</span></div><div role="textbox" aria-multiline="true" class="Editable17 s_zedux_docs_walkthrough_suspense9" data-slate-editor="true" data-slate-editor-id="92" data-slate-node="value" contenteditable="true" zindex="-1"><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token comment" data-slate-leaf="true"><span data-slate-string="true">// mock stuff for example:</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> mockUsers </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Joe&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Jim&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Sally&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Jill&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Bob&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Jamie&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function-variable" data-slate-leaf="true"><span data-slate-string="true">mockFetch</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">new</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token builtin" data-slate-leaf="true"><span data-slate-string="true">Promise</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">resolve </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">setTimeout</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">resolve</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">...</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">mockUsers</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">sort</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> Math</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">random</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">-</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token number" data-slate-leaf="true"><span data-slate-string="true">0.5</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token number" data-slate-leaf="true"><span data-slate-string="true">1500</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token comment" data-slate-leaf="true"><span data-slate-string="true">// start here:</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> fetchAtom </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">atom</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;fetch&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">url</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">:</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token builtin" data-slate-leaf="true"><span data-slate-string="true">string</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> store </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">injectStore</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> subscribe</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">:</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token boolean" data-slate-leaf="true"><span data-slate-string="true">false</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token comment" data-slate-leaf="true"><span data-slate-string="true">// important!</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> promise </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">mockFetch</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">url</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">then</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">data </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> store</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">setState</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">data</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">return</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">api</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">store</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">setPromise</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">promise</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">function</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">RefreshUsers</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> instance </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">useAtomInstance</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">fetchAtom</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;/users&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    suspend</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">:</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token boolean" data-slate-leaf="true"><span data-slate-string="true">false</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">return</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">button</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token attr-name" data-slate-leaf="true"><span data-slate-string="true">onClick</span></span><span class="token script-punctuation" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token script" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token script" data-slate-leaf="true"><span data-slate-string="true"> instance</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">invalidate</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">Refresh</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">button</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">function</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">UsersList</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> users </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">useAtomValue</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">fetchAtom</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;/users&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">return</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">ul</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">users</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">map</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">user </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">        </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">li</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token attr-name" data-slate-leaf="true"><span data-slate-string="true">key</span></span><span class="token script-punctuation" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token script" data-slate-leaf="true"><span data-slate-string="true">user</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">user</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">li</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">ul</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">function</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">Users</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">return</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token class-name" data-slate-leaf="true"><span data-slate-string="true">Suspense</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token attr-name" data-slate-leaf="true"><span data-slate-string="true">fallback</span></span><span class="token script-punctuation" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">div</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span><span class="token script" data-slate-leaf="true"><span data-slate-string="true">fetching users</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">...</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">div</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">        </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token class-name" data-slate-leaf="true"><span data-slate-string="true">UsersList</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">/&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token class-name" data-slate-leaf="true"><span data-slate-string="true">Suspense</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token class-name" data-slate-leaf="true"><span data-slate-string="true">RefreshUsers</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">/&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span></span></div></div></div><div class="div16 s_zedux_docs_walkthrough_suspense10"><span></span></div></section><h2 class="anchor anchorWithStickyNavbar_LWe7" id="query-atoms">Query Atoms<a class="hash-link" href="#query-atoms" title="Direct link to heading">​</a></h2><p>In <a href="/zedux/docs/walkthrough/atom-apis">the atom apis walkthrough</a>, we learned about &quot;query atoms&quot;. A query atom is just an atom whose state factory returns <code>api(promise)</code>. We can revise <code>fetchAtom</code> to use this technique:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> fetchAtom </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;fetch&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> promise </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fetch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This simplified a lot:</p><ul><li>We no longer have to inject our own store and track state ourselves.</li><li>We don&#x27;t have to <code>.setPromise</code> anymore - the promise passed to <code>api()</code> serves as both the atom&#x27;s state source and suspense promise.</li></ul><p>Query atoms have their state set to an object with the following shape:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">PromiseState</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name constant" style="color:rgb(130, 170, 255)">T</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  data</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  error</span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> Error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  isError</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  isLoading</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  isSuccess</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">boolean</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  status</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> PromiseStatus</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">PromiseStatus</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;error&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;loading&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;success&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>They&#x27;re called &quot;query atoms&quot; because they mimic React Query queries.</p></div></div><p>The resolved promise value will be set as the <code>.data</code> property:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">UsersList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useAtomValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fetchAtom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;/users&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">ul</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">li key</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">li</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">ul</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Try plugging the new <code>fetchAtom</code> and <code>UsersList</code> component into the above live sandbox!</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="injectpromise"><code>injectPromise</code><a class="hash-link" href="#injectpromise" title="Direct link to heading">​</a></h2><p>So far we&#x27;ve been creating our promise inline in the state factory. While this is certainly a supported pattern, there are downsides:</p><ul><li><p>A side effect is running immediately when the atom instance is initialized. Since atoms are often initialized during a React render, this means we&#x27;re kicking off side effects during render 😮. Especially when using SSR, this can be a problem.</p></li><li><p>The fetch will run every time this <code>fetchAtom</code> instance is reevaluated. In Zedux, we typically do have more control over when evaluations happen than we do over rerenders in React components. But relying on this pattern still makes code more brittle. For example, it&#x27;s easy for someone to add code later that causes this atom to reevaluate in new cases and voila we have a bug.</p></li></ul><p>We could use <code>injectMemo</code> to at least prevent the fetch from running unnecessarily on reevaluations.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> promise </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectMemo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fetch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But we still have the first problem of the side effect running immediately. A separate injector to isolate these side effects during SSR would be nice. Fortunately there is an injector that solves all of the above: <code>injectPromise</code>.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> fetchAtom </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;fetch&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> queryApi </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fetch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> queryApi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>injectPromise</code> gives you the skeleton of a query atom. The first param is a promise factory function that returns your promise. The second param is a dependency array, just like other injectors like <code>injectEffect</code> and <code>injectMemo</code>. Zedux will only rerun the promise factory when deps change.</p><p><code>injectPromise</code> returns an <a href="/zedux/docs/api/classes/AtomApi">AtomApi</a> with:</p><ul><li>A <code>.store</code> whose state looks like a query atom&#x27;s state (see the above <code>PromiseState</code> interface).</li><li>An attached <code>.promise</code> set to the promise returned from your promise factory.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="atomapi-composition">AtomApi Composition<a class="hash-link" href="#atomapi-composition" title="Direct link to heading">​</a></h3><p>The AtomApi can then be returned directly from your state factory as your atom&#x27;s api. Or you can use the returned store and promise however you want - e.g. to compose them together with other stores/promises:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  createStore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  injectMemo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  injectPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  injectStore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;@zedux/react&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// an atom that fetches a blog post and all its comments:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> blogPostAtom </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;blogPost&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> commentsApi </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fetch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)">/comments/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> postApi </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fetch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token template-string string" style="color:rgb(195, 232, 141)">/post/</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">${</span><span class="token template-string interpolation">id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token template-string template-punctuation string" style="color:rgb(195, 232, 141)">`</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// compose both stores together:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> store </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectStore</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">use</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> comments</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> commentsApi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> post</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> postApi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">store </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> promise </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectMemo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">Promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">all</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">commentsApi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> postApi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">commentsApi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> postApi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-suspense">No Suspense<a class="hash-link" href="#no-suspense" title="Direct link to heading">​</a></h3><p>In components that you don&#x27;t want to suspend, the <code>isSuccess</code>, <code>isError</code>, and <code>isLoading</code> flags can be used to implement old-school loading flows:</p><div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">UserList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> isLoading</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> isSuccess </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useAtomValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fetchUsersAtom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isLoading</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain-text">Loading...</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isSuccess</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">map</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">user </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag class-name" style="color:rgb(255, 203, 107)">User</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:rgb(199, 146, 234)">=</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token tag script language-javascript" style="color:rgb(255, 85, 114)">user</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token tag script language-javascript property-access" style="color:rgb(255, 85, 114)">id</span><span class="token tag script language-javascript punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cleanup">Cleanup<a class="hash-link" href="#cleanup" title="Direct link to heading">​</a></h3><p>Zedux passes an AbortController to the promise factory. Hook into this to cancel fetches or otherwise clean up your async flow.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> fetchAtom </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;fetch&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> queryApi </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    controller </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">fetch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> signal</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">signal </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> queryApi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Just like <code>injectEffect</code>&#x27;s cleanup, Zedux will abort the signal whenever the promise factory runs again due to deps changing and when the atom instance is destroyed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example">Example<a class="hash-link" href="#example" title="Direct link to heading">​</a></h3><p>Let&#x27;s see <code>injectPromise</code> plugged into our <code>fetchAtom</code> example:</p><section class="section18 s_zedux_docs_walkthrough_suspense0"><div class="div12 s_zedux_docs_walkthrough_suspense1"><img src="/zedux/img/zedux-icon-75x75.png"><span class="span14 s_zedux_docs_walkthrough_suspense2">Live Sandbox</span><span class="span13 s_zedux_docs_walkthrough_suspense3"><span class="span9 s_zedux_docs_walkthrough_suspense4"><button class="button6 s_zedux_docs_walkthrough_suspense5"><span>Log</span><svg xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8"><path fill="transparent" stroke="#fff" d="M0 0 L 6 8 L 12 0"></path></svg></button></span><button class="button15 s_zedux_docs_walkthrough_suspense6">Reset</button></span></div><div class="div10 s_zedux_docs_walkthrough_suspense7"><div class="div11 s_zedux_docs_walkthrough_suspense8"><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>10</span><span>11</span><span>12</span><span>13</span><span>14</span><span>15</span><span>16</span><span>17</span><span>18</span><span>19</span><span>20</span><span>21</span><span>22</span><span>23</span><span>24</span><span>25</span><span>26</span><span>27</span><span>28</span><span>29</span><span>30</span><span>31</span><span>32</span><span>33</span><span>34</span><span>35</span><span>36</span><span>37</span><span>38</span><span>39</span><span>40</span><span>41</span><span>42</span><span>43</span><span>44</span><span>45</span><span>46</span><span>47</span><span>48</span><span>49</span><span>50</span><span>51</span><span>52</span></div><div role="textbox" aria-multiline="true" class="Editable17 s_zedux_docs_walkthrough_suspense9" data-slate-editor="true" data-slate-editor-id="93" data-slate-node="value" contenteditable="true" zindex="-1"><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token comment" data-slate-leaf="true"><span data-slate-string="true">// mock stuff for example:</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> mockUsers </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Joe&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Jim&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Sally&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Jill&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Bob&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;Jamie&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function-variable" data-slate-leaf="true"><span data-slate-string="true">mockFetch</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">new</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token builtin" data-slate-leaf="true"><span data-slate-string="true">Promise</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">resolve </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">setTimeout</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">resolve</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">...</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">mockUsers</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">sort</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> Math</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">random</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">-</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token number" data-slate-leaf="true"><span data-slate-string="true">0.5</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token number" data-slate-leaf="true"><span data-slate-string="true">1500</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token comment" data-slate-leaf="true"><span data-slate-string="true">// start here:</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> fetchAtom </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">atom</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;fetch&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">url</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">:</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token builtin" data-slate-leaf="true"><span data-slate-string="true">string</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> queryApi </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">injectPromise</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">mockFetch</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">url</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">url</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">return</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> queryApi</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">function</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">RefreshUsers</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">isPending</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> startTransition</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">useTransition</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> instance </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">useAtomInstance</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">fetchAtom</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;/users&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    suspend</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">:</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token boolean" data-slate-leaf="true"><span data-slate-string="true">false</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">return</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">button</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token attr-name" data-slate-leaf="true"><span data-slate-string="true">onClick</span></span><span class="token script-punctuation" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token script" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token script" data-slate-leaf="true"><span data-slate-string="true"> instance</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">invalidate</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">Refresh</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">does nothing</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">!</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">button</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">function</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">UsersList</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">const</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> data </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">useAtomValue</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">fetchAtom</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">,</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">[</span></span><span class="token string" data-slate-leaf="true"><span data-slate-string="true">&#x27;/users&#x27;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">]</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">return</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">ul</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">data</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">.</span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">map</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">user </span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">=&gt;</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">        </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">li</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token attr-name" data-slate-leaf="true"><span data-slate-string="true">key</span></span><span class="token script-punctuation" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token script" data-slate-leaf="true"><span data-slate-string="true">user</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true">user</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">li</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">ul</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-zero-width="n" data-slate-length="0">﻿<br></span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">function</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token function" data-slate-leaf="true"><span data-slate-string="true">Users</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token keyword" data-slate-leaf="true"><span data-slate-string="true">return</span></span><span class="token" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">(</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token class-name" data-slate-leaf="true"><span data-slate-string="true">Suspense</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token attr-name" data-slate-leaf="true"><span data-slate-string="true">fallback</span></span><span class="token script-punctuation" data-slate-leaf="true"><span data-slate-string="true">=</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">{</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">div</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span><span class="token script" data-slate-leaf="true"><span data-slate-string="true">fetching users</span></span><span class="token operator" data-slate-leaf="true"><span data-slate-string="true">...</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true">div</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">        </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token class-name" data-slate-leaf="true"><span data-slate-string="true">UsersList</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">/&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token class-name" data-slate-leaf="true"><span data-slate-string="true">Suspense</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">      </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;</span></span><span class="token class-name" data-slate-leaf="true"><span data-slate-string="true">RefreshUsers</span></span><span class="token tag" data-slate-leaf="true"><span data-slate-string="true"> </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">/&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">    </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&lt;/</span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">&gt;</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token" data-slate-leaf="true"><span data-slate-string="true">  </span></span><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">)</span></span></span></div><div data-slate-node="element" style="position:relative"><span data-slate-node="text"><span class="token punctuation" data-slate-leaf="true"><span data-slate-string="true">}</span></span></span></div></div></div><div class="div16 s_zedux_docs_walkthrough_suspense10"><span></span></div></section><p>Clicking the button now does nothing because <code>injectPromise</code> prevents the promise from being recreated. The params we pass it (<code>[url]</code>) aren&#x27;t changing, so Zedux doesn&#x27;t rerun the promise factory.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>challenge!</div><div class="admonitionContent_S0QG"><p>Try modifying the above sandbox to make the button work again while still using <code>injectPromise</code> (tip: As with most things in Zedux, there are several ways to go about it).</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="forwarding-promises">Forwarding Promises<a class="hash-link" href="#forwarding-promises" title="Direct link to heading">​</a></h2><p>Say we have a graph where atom <code>a</code> injects atom <code>b</code> which injects atom <code>c</code>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">a -&gt; b -&gt; c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Atoms <code>a</code> and <code>b</code> don&#x27;t set promises, but atom <code>c</code> does. Now say we use atom <code>a</code> in a component. Since we didn&#x27;t set a promise in atom <code>a</code> itself, React won&#x27;t suspend. Atom <code>c</code>&#x27;s promise will be ignored!</p><p>Currently, to get around this, promises must be forwarded manually:</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> atomC </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;c&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">myPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> atomB </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;b&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectAtomInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">atomC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> atomA </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;a&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectAtomInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">atomB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This gives you full flexibility over the async flow. You can use <code>Promise.all()</code> yourself. Or use a <code>Promise.race()</code> or any helper or library for handling parallelization or serialization of promises - you can even use RxJS.</p><div class="language-ts codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ts codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">import</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> from </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;rxjs&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> rxAtom </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;rx&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> asyncInstance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectAtomInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">myAsyncAtom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    controller </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> subscription </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">from</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">asyncInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">pipe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">doCrazyRxStuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">subscribe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">console</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;result:&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      controller</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">signal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">addEventListener</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;abort&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        subscription</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">unsubscribe</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">asyncInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>While this async flexibility is intentional, it does seem boilerplate-heavy compared to Recoil&#x27;s async-by-default approach. We may create an atom type someday that mimics Recoil. In fact, an early prototype of Zedux already did. We pivoted from that approach because we didn&#x27;t need it at Omnistac. This may be a job we leave up to userspace.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="manual-suspense">Manual Suspense<a class="hash-link" href="#manual-suspense" title="Direct link to heading">​</a></h2><p>You don&#x27;t have to use Zedux&#x27; built-in suspense handling. Here&#x27;s an example exporting a promise and handling suspense by hand:</p><div class="language-tsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-tsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> fetchAtom </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">atom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;fetch&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> store </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">injectPromise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fetch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">data </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">json</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">url</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">setExports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> promise </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Username</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> userInstance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useAtomInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fetchAtom</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;/user&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> isError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> isLoading </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useAtomValue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">userInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isError</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">throw</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;User request failed&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">isLoading</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">throw</span><span class="token plain"> userInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">exports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">promise</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">username</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">div</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>This example is a little contrived - you probably wouldn&#x27;t want to export the promise itself since exports are constant but the promise reference could change. Instead export a getter function or a ref.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recap">Recap<a class="hash-link" href="#recap" title="Direct link to heading">​</a></h2><ul><li>Set an atom instance&#x27;s promise by returning an AtomApi with a promise attached via <code>.setPromise()</code><ul><li>Or pass the promise directly to <code>api(promise)</code> to create a &quot;query atom&quot;.</li></ul></li><li><code>injectPromise</code> gives you more granular control over the store and promise of a query.</li><li>Promises must be forwarded manually to trigger React suspense.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a class="hash-link" href="#next-steps" title="Direct link to heading">​</a></h2><p>One of the most efficient ways to trigger React suspense is with <a href="/zedux/docs/walkthrough/query-atoms">query atoms</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Omnistac/zedux/tree/master/docs/walkthrough/suspense.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/zedux/docs/walkthrough/react-context"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">React Context</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/zedux/docs/walkthrough/query-atoms"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Query Atoms</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quick-overview" class="table-of-contents__link toc-highlight">Quick Overview</a></li><li><a href="#changing-the-promise" class="table-of-contents__link toc-highlight">Changing the Promise</a></li><li><a href="#query-atoms" class="table-of-contents__link toc-highlight">Query Atoms</a></li><li><a href="#injectpromise" class="table-of-contents__link toc-highlight"><code>injectPromise</code></a><ul><li><a href="#atomapi-composition" class="table-of-contents__link toc-highlight">AtomApi Composition</a></li><li><a href="#no-suspense" class="table-of-contents__link toc-highlight">No Suspense</a></li><li><a href="#cleanup" class="table-of-contents__link toc-highlight">Cleanup</a></li><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li></ul></li><li><a href="#forwarding-promises" class="table-of-contents__link toc-highlight">Forwarding Promises</a></li><li><a href="#manual-suspense" class="table-of-contents__link toc-highlight">Manual Suspense</a></li><li><a href="#recap" class="table-of-contents__link toc-highlight">Recap</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zedux/docs/walkthrough/quick-start">React</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Omnistac/zedux" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/josh_claunch" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2017-2023 Joshua Claunch. Built with Docusaurus.</div></div></div></footer></div></div>
<script src="/zedux/assets/js/runtime~main.135d385d.js"></script>
<script src="/zedux/assets/js/main.e6a207f2.js"></script>
</body>
</html>